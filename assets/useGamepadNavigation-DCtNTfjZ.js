import{r as e}from"./react-7X_HfTL4.js";const t=(t=!0)=>{const[n,o]=e.useState(null),[s,r]=e.useState([]),[a,l]=e.useState(!1),[c,i]=e.useState(!1),u=e.useRef(0),d=e.useRef({}),g=e.useCallback((()=>{if(!t)return;const e=Array.from(document.querySelectorAll('[data-gamepad-focusable="true"]:not([disabled]), [data-gamepad-scrollable="true"]')).filter((e=>{const t=e.getBoundingClientRect();if(0===t.width&&0===t.height){const t=e.closest("label")||e.closest('[class*="toggle"]')||e.parentElement;if(!t)return!1;{const e=t.getBoundingClientRect();if(0===e.width||0===e.height)return!1}}const n=document.querySelectorAll('[class*="modal"], [class*="Modal"], [role="dialog"], [class*="overlay"]');if(n.length>0){const t=Array.from(n).filter((e=>{const t=e.className;return t.includes("modal")||t.includes("Modal")||"dialog"===e.getAttribute("role")}));if(t.length>0){const n=t.sort(((e,t)=>{let n=parseInt(window.getComputedStyle(e).zIndex)||0,o=parseInt(window.getComputedStyle(t).zIndex)||0;if(0===n){const t=e.parentElement;t&&t.classList.toString().includes("overlay")&&(n=parseInt(window.getComputedStyle(t).zIndex)||0)}if(0===o){const e=t.parentElement;e&&e.classList.toString().includes("overlay")&&(o=parseInt(window.getComputedStyle(e).zIndex)||0)}return o-n}))[0];return n&&n.contains(e)}}return!0}));r((t=>t.length===e.length&&t.every(((t,n)=>t===e[n]))?t:e))}),[t]),f=e.useCallback((e=>{const t=Date.now();if(t-u.current<150)return;if(u.current=t,!s.length)return;i(!0);const r=document.activeElement;let a=n;r&&"true"===r.getAttribute("data-gamepad-focusable")&&s.includes(r)&&(a=r,o(r));const l=s.findIndex((e=>e===a));if(-1===l||!a){const e=s[0];return o(e),void e.focus()}const c=s[l];if("true"===c?.getAttribute("data-gamepad-scrollable")&&("up"===e||"down"===e)){const t=50,n=c.scrollTop<=0,o=c.scrollTop>=c.scrollHeight-c.clientHeight;if("up"===e&&!n)return void(c.scrollTop=Math.max(0,c.scrollTop-t));if("down"===e&&!o)return void(c.scrollTop=Math.min(c.scrollHeight-c.clientHeight,c.scrollTop+t))}let d=null;if("up"===e||"down"===e){let t=c?.getBoundingClientRect();if(!t)return;if(0===t.width&&0===t.height){const e=c.closest("label"),n=c.closest('[class*="toggle"]')||c.closest('[class*="Toggle"]'),o=e||n||c.parentElement;o&&(t=o.getBoundingClientRect())}const n=t.left+t.width/2,o=s.map(((e,t)=>({el:e,index:t,rect:e.getBoundingClientRect()}))).filter((({el:n,rect:o,index:s})=>s!==l&&("up"===e?o.bottom<=t.top+20:o.top>=t.bottom-20)));if(o.length>0){d=o.map((o=>({...o,horizontalDistance:Math.abs(o.rect.left+o.rect.width/2-n),verticalDistance:"up"===e?t.top-o.rect.bottom:o.rect.top-t.bottom}))).sort(((e,t)=>{const n=e.horizontalDistance-t.horizontalDistance;if(Math.abs(n)>100)return n;const o=e.verticalDistance-t.verticalDistance;return Math.abs(o)>10?o:n}))[0].el}else{const t=s.filter(((e,t)=>t!==l)).map(((e,t)=>({el:e,rect:e.getBoundingClientRect()})));if(t.length>0){const n="up"===e?0:window.innerHeight;d=t.reduce(((e,t)=>Math.abs(t.rect.top-n)<Math.abs(e.rect.top-n)?t:e)).el}else d="up"===e?s[s.length-1]:s[0]}}else{const t=c?.getBoundingClientRect();if(t){const n=t.top+t.height/2,o=Math.max(t.height/2,20),r=s.map(((e,t)=>({el:e,index:t,rect:e.getBoundingClientRect()}))).filter((({rect:e,index:t})=>{const s=e.top+e.height/2;return Math.abs(s-n)<=o})).sort(((e,t)=>e.rect.left-t.rect.left)),a=r.findIndex((({el:e})=>e===c));d=-1!==a&&r.length>1?"left"===e?a>0?r[a-1].el:null:a<r.length-1?r[a+1].el:null:null}else d="left"===e?l>0?s[l-1]:s[s.length-1]:l<s.length-1?s[l+1]:s[0]}d&&(o(d),d.focus())}),[s,n]),m=e.useCallback((()=>{const e="true"===document.activeElement?.getAttribute("data-gamepad-focusable")?document.activeElement:n;e&&(i(!0),e.click())}),[n]);return e.useEffect((()=>{if(!t)return;const e=e=>{if(!(document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName))||"Enter"!==e.key)switch(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(e.key)&&e.preventDefault(),e.key){case"ArrowUp":f("up");break;case"ArrowDown":f("down");break;case"ArrowLeft":f("left");break;case"ArrowRight":f("right");break;case"Enter":case" ":m()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[f,m,t]),e.useEffect((()=>{if(!t)return;let e;const n=()=>{const t=navigator.getGamepads();let o=!1;for(let e=0;e<t.length;e++){const n=t[e];if(n&&n.connected){o=!0,d.current[e]||(d.current[e]={});const t=d.current[e],s=n.buttons[12]?.pressed,r=n.buttons[13]?.pressed,a=n.buttons[14]?.pressed,l=n.buttons[15]?.pressed,c=n.buttons[0]?.pressed;s&&!t.up&&f("up"),r&&!t.down&&f("down"),a&&!t.left&&f("left"),l&&!t.right&&f("right"),c&&!t.a&&m(),t.up=s,t.down=r,t.left=a,t.right=l,t.a=c;const i=n.axes[0]||0,u=n.axes[1]||0,g=.3;!t.stickMoved&&(Math.abs(i)>g||Math.abs(u)>g)?(Math.abs(i)>Math.abs(u)?i>g?f("right"):i<-.3&&f("left"):u>g?f("down"):u<-.3&&f("up"),t.stickMoved=!0):Math.abs(i)<=g&&Math.abs(u)<=g&&(t.stickMoved=!1);const h=n.axes[2]||0,p=n.axes[3]||0,b=.2,v=8;if(Math.abs(p)>b){const e=p*v;window.scrollBy(0,e)}if(Math.abs(h)>b){const e=h*v;window.scrollBy(e,0)}}}l(o),e=requestAnimationFrame(n)};return n(),()=>{e&&cancelAnimationFrame(e)}}),[f,m,t]),e.useEffect((()=>{if(!t)return;const e=()=>{i(!1)};return document.addEventListener("mousemove",e),()=>document.removeEventListener("mousemove",e)}),[t]),e.useEffect((()=>(c?document.body.classList.add("gamepad-navigation-active"):document.body.classList.remove("gamepad-navigation-active"),()=>{document.body.classList.remove("gamepad-navigation-active")})),[c]),e.useEffect((()=>{if(s.length>0&&!n){const e=s[0];o(e)}}),[s.length]),e.useEffect((()=>{if(!t)return;const e=e=>{const t=e.target;t&&"true"===t.getAttribute("data-gamepad-focusable")&&(g(),setTimeout((()=>{Array.from(document.querySelectorAll('[data-gamepad-focusable="true"]:not([disabled]), [data-gamepad-scrollable="true"]')).includes(t)&&o(t)}),0))};return document.addEventListener("focus",e,!0),()=>{document.removeEventListener("focus",e,!0)}}),[t,g]),e.useEffect((()=>{if(!t)return;const e=new MutationObserver(g);return e.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-gamepad-focusable","disabled"]}),g(),()=>e.disconnect()}),[g,t]),{focusedElement:n,isGamepadConnected:a,showFocusIndicator:c,registerNavigableElements:g}};export{t as u};
