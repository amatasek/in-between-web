import{Q as E,M as e,R as O,I as D,T as M,U as T,V as U}from"./index-DXVwC8XD.js";import{b as N,u as W}from"./vendor-ByZL_ylL.js";import{u as H}from"./useGamepadNavigation-DCsD-Nlu.js";import{A as R}from"./AppHeader-CnLYVNU1.js";import{C as q,U as Q,R as F,P as J,S as Y,a as V,b as X,T as I,G as w}from"./GamepadInput-B2au6Gps.js";import"./audio-Do0jXn0P.js";import"./socket-CA1CrNgP.js";const Z="_lobbyScreen_oxzm8_1",K="_gameListTitle_oxzm8_34",ee="_searchContainer_oxzm8_47",te="_gameListWrapper_oxzm8_84",se="_userDisconnectedGame_oxzm8_103",ae="_userInGame_oxzm8_110",ne="_gameListInfo_oxzm8_133",re="_gameListId_oxzm8_138",oe="_disconnectedBadge_oxzm8_147",ie="_inGameBadge_oxzm8_159",le="_gameListPlayers_oxzm8_171",ce="_emptyStateIcon_oxzm8_238",me="_emptyStateMessage_oxzm8_244",de="_emptyStateHint_oxzm8_251",ue="_privatePill_oxzm8_257",pe="_gameActionsSection_oxzm8_270",xe="_gameCard_oxzm8_277",p={lobbyScreen:Z,gameListTitle:K,searchContainer:ee,gameListWrapper:te,userDisconnectedGame:se,userInGame:ae,gameListInfo:ne,gameListId:re,disconnectedBadge:oe,inGameBadge:ie,gameListPlayers:le,emptyStateIcon:ce,emptyStateMessage:me,emptyStateHint:de,privatePill:ue,gameActionsSection:pe,gameCard:xe},he="_pill_q09di_1",ge="_pulse_q09di_23",Ne="_text_q09di_49",A={pill:he,pulse:ge,text:Ne},fe=()=>{const{socket:n,isConnected:o}=E(),[i,s]=N.useState(null);return N.useEffect(()=>{if(!n||!o)return;n.emit("getOnlinePlayerCount",a=>{s(a)});const h=a=>s(a);return n.on("onlinePlayerCountUpdate",h),()=>{n.off("onlinePlayerCountUpdate",h)}},[n,o]),i===null?null:e.jsxs("div",{className:A.pill,children:[e.jsx("span",{className:A.pulse}),e.jsxs("span",{className:A.text,children:[i," online"]})]})},je="_balanceSection_1ap8t_1",_e="_balanceLabel_1ap8t_10",be="_xpSection_1ap8t_17",ve="_xpBarContainer_1ap8t_21",Ce="_xpOverlay_1ap8t_31",ye="_xpLevel_1ap8t_45",Se="_xpNext_1ap8t_52",we="_xpBar_1ap8t_21",_={balanceSection:je,balanceLabel:_e,xpSection:be,xpBarContainer:ve,xpOverlay:Ce,xpLevel:ye,xpNext:Se,xpBar:we},Ie=({userId:n,balance:o})=>{const i=O(n);return e.jsxs("div",{className:"panel-alt",style:{width:"100%",flex:2},children:[e.jsxs("div",{className:_.balanceSection,children:[e.jsx("span",{className:_.balanceLabel,children:"Balance:"}),e.jsx(q,{amount:Number(o)||0,size:"medium"})]}),i&&e.jsx("div",{className:_.xpSection,children:e.jsxs("div",{className:_.xpBarContainer,children:[e.jsx("div",{className:_.xpBar,style:{width:i.level>=100?"100%":`${i.percentToNextLevel||0}%`}}),e.jsxs("div",{className:_.xpOverlay,children:[e.jsxs("div",{className:_.xpLevel,children:["Level ",i.level]}),e.jsx("div",{className:_.xpNext,children:i.level<100?`${i.xpToNextLevel.toLocaleString()} XP`:"MAX"})]})]})})]})},Be="_userSection_53k67_2",Ae="_avatarContainer_53k67_12",Le="_headerButtons_53k67_16",Ge="_logoutButton_53k67_40",S={userSection:Be,avatarContainer:Ae,headerButtons:Le,logoutButton:Ge},Pe=()=>{const{user:n,logout:o,refreshUserData:i}=D(),[s,h]=N.useState(!1);return e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{className:`panel ${S.userSection}`,children:[e.jsx("div",{className:S.avatarContainer,children:e.jsx(Q,{userId:n?.id,size:"medium",showName:!0,namePosition:"right"})}),e.jsx(Ie,{userId:n?.id,balance:n?.balance}),e.jsxs("div",{className:S.headerButtons,children:[e.jsx("button",{className:S.logoutButton,onClick:o,"data-gamepad-focusable":"true",children:e.jsx("span",{className:S.buttonText,children:"Logout"})}),e.jsx(F,{"data-gamepad-focusable":"true"}),e.jsx(J,{"data-gamepad-focusable":"true"}),e.jsx(Y,{onClick:()=>h(!0),"data-gamepad-focusable":"true"}),e.jsx(V,{"data-gamepad-focusable":"true"})]})]}),s&&e.jsx(X,{onClose:()=>{h(!1),i&&i()}})]})},$e=({className:n="",width:o="1em",height:i="1em",...s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`feather feather-lock ${n}`,width:o,height:i,...s,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]});function ze({game:n,onJoin:o,userId:i}){const s=n.settings?.customName||`Game ${n.id}`,h=n.disconnectedPlayers?.some(x=>x.userId===i),a=n.allPlayers?.some(x=>x.userId===i&&!x.disconnected);let c="Join";h?c="Reconnect":a&&(c="Continue");let b=`panel ${p.gameCard}`;return h?b+=` ${p.userDisconnectedGame}`:a&&(b+=` ${p.userInGame}`),e.jsxs("div",{className:b,children:[" ",e.jsxs("div",{className:p.gameListInfo,style:{flex:1},children:[e.jsxs("div",{className:p.gameListId,children:[" ",s,n.settings?.isPrivate&&e.jsxs("span",{className:p.privatePill,title:"Private Game",children:[e.jsx($e,{width:"0.9em",height:"0.9em",style:{marginRight:"4px",verticalAlign:"middle"}}),"Private"]}),h&&e.jsx("span",{className:p.disconnectedBadge,title:"You're disconnected from this game",children:"⚠️ Reconnect"}),a&&e.jsx("span",{className:p.inGameBadge,title:"You're in this game",children:"You're In"})]}),e.jsxs("div",{className:p.gameListPlayers,children:[" ",n.playerCount," ",n.playerCount===1?"player":"players"]})]}),e.jsx("button",{className:"btn btn-primary",style:{padding:"0.4rem 1rem",fontSize:"0.9rem",minWidth:"80px",maxWidth:"100px",flexShrink:0},onClick:()=>o(n.id),disabled:!i,"data-gamepad-focusable":"true",children:c})]})}const Ee="_gameSettingItem_tzwbj_1",De="_settingDescription_tzwbj_13",ke="_settingControls_tzwbj_35",Oe="_textInput_tzwbj_42",Me="_inputError_tzwbj_60",r={gameSettingItem:Ee,settingDescription:De,settingControls:ke,textInput:Oe,inputError:Me},z={useCustomName:!1,customName:"",isPrivate:!1,password:"",enableAceChoice:!0,enableSecondChance:!0,numberOfBots:0,anteAmount:""},Te=({initialSettings:n=z,onSubmit:o,onClose:i})=>{const[s,h]=N.useState({...z,...n}),[a,c]=N.useState({}),b=t=>{const d={};if(t.useCustomName){const m=t.customName||"";m?m.length<4||m.length>26?d.customName="Name must be 4-26 characters.":/^[a-zA-Z0-9_-]+$/.test(m)||(d.customName="Use letters, numbers, -, or _."):d.customName="Custom name is required."}if(t.isPrivate){const m=t.password||"";m?(m.length<3||m.length>36)&&(d.password="Password must be 3-36 characters."):d.password="Password is required."}const u=t.numberOfBots;(u<0||u>16)&&(d.numberOfBots="Number of bots must be between 0 and 16.");const l=t.anteAmount;if(l!==""&&l!==null&&l!==void 0){const m=parseInt(l);(isNaN(m)||m<1||m>100)&&(d.anteAmount="Ante amount must be between 1 and 100.")}return d},x=(t,d)=>{h(u=>{const l={...u,[t]:d};return t==="useCustomName"&&!d&&(l.customName="",a.customName&&c(m=>{const v={...m};return delete v.customName,v})),t==="isPrivate"&&!d&&(l.password="",a.password&&c(m=>{const v={...m};return delete v.password,v})),l}),(t==="customName"||t==="useCustomName")&&a.customName&&c(u=>{const l={...u};return delete l.customName,l}),(t==="password"||t==="isPrivate")&&a.password&&c(u=>{const l={...u};return delete l.password,l}),t==="numberOfBots"&&a.numberOfBots&&c(u=>{const l={...u};return delete l.numberOfBots,l}),t==="anteAmount"&&a.anteAmount&&c(u=>{const l={...u};return delete l.anteAmount,l})},y=t=>{t.preventDefault();const d=b(s);if(Object.keys(d).length>0)c(d);else{c({});const u={...s,customName:s.useCustomName?s.customName:null,anteAmount:s.anteAmount===""?1:parseInt(s.anteAmount)};delete u.useCustomName,o(u)}};return e.jsx(M,{title:"Game Options",onClose:i,style:{maxWidth:600},footer:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:i,className:"btn btn-secondary","data-gamepad-focusable":"true",children:"Cancel"}),e.jsx("button",{type:"submit",form:"gameSettingsForm",className:"btn btn-primary",disabled:Object.keys(a).length>0,"data-gamepad-focusable":"true",children:"Create Game"})]}),children:e.jsxs("form",{id:"gameSettingsForm",onSubmit:y,children:[e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Custom Game Name"}),e.jsx("p",{children:"Set a custom name for your game lobby"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(I,{isChecked:s.useCustomName,onChange:t=>x("useCustomName",t.target.checked)}),s.useCustomName&&e.jsx(w,{title:"Enter Game Name",type:"text",value:s.customName||"",onChange:t=>x("customName",t.target.value),className:`${r.textInput}${a.customName?" "+r.inputError:""}`,placeholder:"Game Name",maxLength:26,style:{marginTop:8}}),a.customName&&e.jsx("span",{className:"errorMessage",children:a.customName})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Private Game"}),e.jsx("p",{children:"Only players with the password can join"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(I,{isChecked:s.isPrivate,onChange:t=>x("isPrivate",t.target.checked)}),s.isPrivate&&e.jsx(w,{title:"Enter Game Password",type:"text",value:s.password||"",onChange:t=>x("password",t.target.value),className:`${r.textInput}${a.password?" "+r.inputError:""}`,placeholder:"Password",maxLength:36,style:{marginTop:8}}),a.password&&e.jsx("span",{className:"errorMessage",children:a.password})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Number of Bots"}),e.jsx("p",{children:"Add AI players to your game (0-16)"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(w,{title:"Number of AI Players",type:"number",min:"0",max:"16",value:s.numberOfBots===0?"":s.numberOfBots,onChange:t=>x("numberOfBots",t.target.value===""?0:parseInt(t.target.value)||0),className:`${r.textInput} no-validation${a.numberOfBots?" "+r.inputError:""}`,placeholder:"0"}),a.numberOfBots&&e.jsx("span",{className:"errorMessage",children:a.numberOfBots})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Ante Amount"}),e.jsx("p",{children:"Set the ante amount for each round (1-100)"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(w,{title:"Ante Amount",type:"number",min:"1",max:"100",value:s.anteAmount,onChange:t=>x("anteAmount",t.target.value),className:`${r.textInput} no-validation${a.anteAmount?" "+r.inputError:""}`,placeholder:"1"}),a.anteAmount&&e.jsx("span",{className:"errorMessage",children:a.anteAmount})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Enable Ace Choice"}),e.jsx("p",{children:"Allow players to choose high/low on Ace"})]}),e.jsx("div",{className:r.settingControls,children:e.jsx(I,{isChecked:s.enableAceChoice,onChange:t=>x("enableAceChoice",t.target.checked)})})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Enable Second Chance"}),e.jsx("p",{children:"Allow players to ante up for a second chance"})]}),e.jsx("div",{className:r.settingControls,children:e.jsx(I,{isChecked:s.enableSecondChance,onChange:t=>x("enableSecondChance",t.target.checked)})})]})]})})},Je=()=>{const{gameList:n}=T(),{user:o,logout:i}=D(),{socket:s,isConnected:h}=E();H(!0);const a=W(),[c,b]=N.useState(""),[x,y]=N.useState(!1),t=o?.username?`user_${o.username}`:null;N.useEffect(()=>{if(o&&(!o.username||!o.id)){console.error("[Lobby] Invalid user data received:",o),i();return}},[o,i]);const d=g=>{!h||!o||(U.play("ui.click"),a(`/${g}`))},u=g=>{b(g.target.value)},l=g=>{if(!o?.id||!h)return;const f=j=>{s.off("gameCreated",f),j?.game?.id&&a(`/${j.game.id}`)};s.on("gameCreated",f),g?s.emit("createGame",{settings:g}):s.emit("createGame")},m=()=>l({numberOfBots:5}),v=()=>{y(!0)},k=g=>{y(!1),l(g)},B=N.useMemo(()=>{if(!n)return[];let g=n;if(c.trim()){const f=c.trim().toLowerCase();g=n.filter(j=>j.id.toLowerCase().includes(f))}return g.sort((f,j)=>{const L=f.allPlayers?.some(C=>C.userId===t),G=j.allPlayers?.some(C=>C.userId===t),P=f.disconnectedPlayers?.some(C=>C.userId===t),$=j.disconnectedPlayers?.some(C=>C.userId===t);return P&&!$?-1:!P&&$?1:L&&!G?-1:!L&&G?1:f.id.localeCompare(j.id)})},[n,c,t]);return e.jsxs("div",{className:`screen ${p.lobbyScreen}`,children:[e.jsx(R,{}),e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"1.1em",marginBottom:"-0.6em"},children:e.jsx(fe,{})}),e.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"600px",marginBottom:"2rem"},children:[e.jsx(Pe,{}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:p.gameActionsSection,children:[e.jsx("button",{className:"btn btn-primary",onClick:m,disabled:!o?.username,"data-gamepad-focusable":"true",children:"Create Quick Game"}),e.jsx("button",{className:"btn btn-primary",onClick:v,disabled:!o?.username,"data-gamepad-focusable":"true",children:"Create Custom Game"})]})]}),e.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"600px",minHeight:"200px"},children:[e.jsx("h2",{className:p.gameListTitle,children:"Available Games"}),e.jsx("div",{className:p.searchContainer,children:e.jsxs("div",{className:"input-with-icon",children:[e.jsx("span",{className:"input-icon left",children:"🔍"}),e.jsx(w,{title:"Search Games",type:"search",className:"no-validation",placeholder:"Search games by ID",value:c,onChange:u})]})}),B&&B.length>0?e.jsx("div",{className:p.gameListWrapper,children:B.map(g=>e.jsx(ze,{game:g,onJoin:d,userId:t},g.id))}):e.jsxs("div",{className:"panel-alt",style:{textAlign:"center",padding:"2rem",minHeight:"150px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{className:p.emptyStateIcon,children:"🃏"}),e.jsx("p",{className:p.emptyStateMessage,children:c.trim()?"No matching games found":"No games in progress"}),e.jsx("p",{className:p.emptyStateHint,children:c.trim()?"Try a different search or create a new game":"Create a new game to get started!"})]})]}),x&&e.jsx(Te,{onSubmit:k,onClose:()=>y(!1)})]})};export{Je as default};
