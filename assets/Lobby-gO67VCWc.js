import{a3 as D,U as e,a4 as U,a2 as k,a5 as W,a6 as z,a7 as H}from"./index-C276OUw1.js";import{r as f,u as q}from"./vendor-BGrsVhb6.js";import{u as R}from"./useGamepadNavigation-x_XbBJyI.js";import{A as F}from"./AppHeader-fGbNd50B.js";import{C as J,U as Q,R as V,P as Y,S as X,a as Z,b as K,T as w,G as I}from"./GamepadInput-C3ukOrNw.js";import{g as ee}from"./version-D_D3KWlY.js";import"./audio-DNG-5txZ.js";import"./socket-CA1CrNgP.js";const te="_lobbyScreen_h2tc4_1",se="_versionInfo_h2tc4_6",ae="_gameListTitle_h2tc4_44",ne="_searchContainer_h2tc4_57",re="_gameListWrapper_h2tc4_94",oe="_userDisconnectedGame_h2tc4_113",ie="_userInGame_h2tc4_120",ce="_gameListInfo_h2tc4_143",le="_gameListId_h2tc4_148",me="_disconnectedBadge_h2tc4_157",de="_inGameBadge_h2tc4_169",ue="_gameListPlayers_h2tc4_181",pe="_emptyStateIcon_h2tc4_248",he="_emptyStateMessage_h2tc4_254",xe="_emptyStateHint_h2tc4_261",ge="_privatePill_h2tc4_267",fe="_gameActionsSection_h2tc4_280",Ne="_gameCard_h2tc4_287",u={lobbyScreen:te,versionInfo:se,gameListTitle:ae,searchContainer:ne,gameListWrapper:re,userDisconnectedGame:oe,userInGame:ie,gameListInfo:ce,gameListId:le,disconnectedBadge:me,inGameBadge:de,gameListPlayers:ue,emptyStateIcon:pe,emptyStateMessage:he,emptyStateHint:xe,privatePill:ge,gameActionsSection:fe,gameCard:Ne},je="_pill_q09di_1",_e="_pulse_q09di_23",ve="_text_q09di_49",A={pill:je,pulse:_e,text:ve},be=()=>{const{socket:n,isConnected:o}=D(),[i,s]=f.useState(null);return f.useEffect(()=>{if(!n||!o)return;n.emit("getOnlinePlayerCount",a=>{s(a)});const x=a=>s(a);return n.on("onlinePlayerCountUpdate",x),()=>{n.off("onlinePlayerCountUpdate",x)}},[n,o]),i===null?null:e.jsxs("div",{className:A.pill,children:[e.jsx("span",{className:A.pulse}),e.jsxs("span",{className:A.text,children:[i," online"]})]})},Ce="_balanceSection_1ap8t_1",ye="_balanceLabel_1ap8t_10",Se="_xpSection_1ap8t_17",Ie="_xpBarContainer_1ap8t_21",we="_xpOverlay_1ap8t_31",Be="_xpLevel_1ap8t_45",Ae="_xpNext_1ap8t_52",Le="_xpBar_1ap8t_21",v={balanceSection:Ce,balanceLabel:ye,xpSection:Se,xpBarContainer:Ie,xpOverlay:we,xpLevel:Be,xpNext:Ae,xpBar:Le},Ge=({userId:n,balance:o})=>{const i=U(n);return e.jsxs("div",{className:"panel-alt",style:{width:"100%",flex:2},children:[e.jsxs("div",{className:v.balanceSection,children:[e.jsx("span",{className:v.balanceLabel,children:"Balance:"}),e.jsx(J,{amount:Number(o)||0,size:"medium"})]}),i&&e.jsx("div",{className:v.xpSection,children:e.jsxs("div",{className:v.xpBarContainer,children:[e.jsx("div",{className:v.xpBar,style:{width:i.level>=100?"100%":`${i.percentToNextLevel||0}%`}}),e.jsxs("div",{className:v.xpOverlay,children:[e.jsxs("div",{className:v.xpLevel,children:["Level ",i.level]}),e.jsx("div",{className:v.xpNext,children:i.level<100?`${i.xpToNextLevel.toLocaleString()} XP`:"MAX"})]})]})})]})},Pe="_userSection_53k67_2",$e="_avatarContainer_53k67_12",Ee="_headerButtons_53k67_16",De="_logoutButton_53k67_40",S={userSection:Pe,avatarContainer:$e,headerButtons:Ee,logoutButton:De},ke=()=>{const{user:n,logout:o,refreshUserData:i}=k(),[s,x]=f.useState(!1);return e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{className:`panel ${S.userSection}`,children:[e.jsx("div",{className:S.avatarContainer,children:e.jsx(Q,{userId:n?.id,size:"medium",showName:!0,namePosition:"right"})}),e.jsx(Ge,{userId:n?.id,balance:n?.balance}),e.jsxs("div",{className:S.headerButtons,children:[e.jsx("button",{className:S.logoutButton,onClick:o,"data-gamepad-focusable":"true",children:e.jsx("span",{className:S.buttonText,children:"Logout"})}),e.jsx(V,{"data-gamepad-focusable":"true"}),e.jsx(Y,{"data-gamepad-focusable":"true"}),e.jsx(X,{onClick:()=>x(!0),"data-gamepad-focusable":"true"}),e.jsx(Z,{"data-gamepad-focusable":"true"})]})]}),s&&e.jsx(K,{onClose:()=>{x(!1),i&&i()}})]})},Oe=({className:n="",width:o="1em",height:i="1em",...s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`feather feather-lock ${n}`,width:o,height:i,...s,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]});function Me({game:n,onJoin:o,userId:i}){const s=n.settings?.customName||`Game ${n.id}`,x=n.disconnectedPlayers?.some(h=>h.userId===i),a=n.allPlayers?.some(h=>h.userId===i&&!h.disconnected);let m="Join";x?m="Reconnect":a&&(m="Continue");let b=`panel ${u.gameCard}`;return x?b+=` ${u.userDisconnectedGame}`:a&&(b+=` ${u.userInGame}`),e.jsxs("div",{className:b,children:[" ",e.jsxs("div",{className:u.gameListInfo,style:{flex:1},children:[e.jsxs("div",{className:u.gameListId,children:[" ",s,n.settings?.isPrivate&&e.jsxs("span",{className:u.privatePill,title:"Private Game",children:[e.jsx(Oe,{width:"0.9em",height:"0.9em",style:{marginRight:"4px",verticalAlign:"middle"}}),"Private"]}),x&&e.jsx("span",{className:u.disconnectedBadge,title:"You're disconnected from this game",children:"âš ï¸ Reconnect"}),a&&e.jsx("span",{className:u.inGameBadge,title:"You're in this game",children:"You're In"})]}),e.jsxs("div",{className:u.gameListPlayers,children:[" ",n.playerCount," ",n.playerCount===1?"player":"players"]})]}),e.jsx("button",{className:"btn btn-primary",style:{padding:"0.4rem 1rem",fontSize:"0.9rem",minWidth:"80px",maxWidth:"100px",flexShrink:0},onClick:()=>o(n.id),disabled:!i,"data-gamepad-focusable":"true",children:m})]})}const Te="_gameSettingItem_tzwbj_1",Ue="_settingDescription_tzwbj_13",We="_settingControls_tzwbj_35",ze="_textInput_tzwbj_42",He="_inputError_tzwbj_60",r={gameSettingItem:Te,settingDescription:Ue,settingControls:We,textInput:ze,inputError:He},E={useCustomName:!1,customName:"",isPrivate:!1,password:"",enableAceChoice:!0,enableSecondChance:!0,numberOfBots:0,anteAmount:""},qe=({initialSettings:n=E,onSubmit:o,onClose:i})=>{const[s,x]=f.useState({...E,...n}),[a,m]=f.useState({}),b=t=>{const p={};if(t.useCustomName){const d=t.customName||"";d?d.length<4||d.length>26?p.customName="Name must be 4-26 characters.":/^[a-zA-Z0-9_-]+$/.test(d)||(p.customName="Use letters, numbers, -, or _."):p.customName="Custom name is required."}if(t.isPrivate){const d=t.password||"";d?(d.length<3||d.length>36)&&(p.password="Password must be 3-36 characters."):p.password="Password is required."}const c=t.numberOfBots;(c<0||c>16)&&(p.numberOfBots="Number of bots must be between 0 and 16.");const l=t.anteAmount;if(l!==""&&l!==null&&l!==void 0){const d=parseInt(l);(isNaN(d)||d<1||d>100)&&(p.anteAmount="Ante amount must be between 1 and 100.")}return p},h=(t,p)=>{x(c=>{const l={...c,[t]:p};return t==="useCustomName"&&!p&&(l.customName="",a.customName&&m(d=>{const N={...d};return delete N.customName,N})),t==="isPrivate"&&!p&&(l.password="",a.password&&m(d=>{const N={...d};return delete N.password,N})),l}),(t==="customName"||t==="useCustomName")&&a.customName&&m(c=>{const l={...c};return delete l.customName,l}),(t==="password"||t==="isPrivate")&&a.password&&m(c=>{const l={...c};return delete l.password,l}),t==="numberOfBots"&&a.numberOfBots&&m(c=>{const l={...c};return delete l.numberOfBots,l}),t==="anteAmount"&&a.anteAmount&&m(c=>{const l={...c};return delete l.anteAmount,l})},y=t=>{t.preventDefault();const p=b(s);if(Object.keys(p).length>0)m(p);else{m({});const c={...s,customName:s.useCustomName?s.customName:null,anteAmount:s.anteAmount===""?1:parseInt(s.anteAmount)};delete c.useCustomName,o(c)}};return e.jsx(W,{title:"Game Options",onClose:i,style:{maxWidth:600},footer:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:i,className:"btn btn-secondary","data-gamepad-focusable":"true",children:"Cancel"}),e.jsx("button",{type:"submit",form:"gameSettingsForm",className:"btn btn-primary",disabled:Object.keys(a).length>0,"data-gamepad-focusable":"true",children:"Create Game"})]}),children:e.jsxs("form",{id:"gameSettingsForm",onSubmit:y,children:[e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Custom Game Name"}),e.jsx("p",{children:"Set a custom name for your game lobby"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(w,{isChecked:s.useCustomName,onChange:t=>h("useCustomName",t.target.checked)}),s.useCustomName&&e.jsx(I,{title:"Enter Game Name",type:"text",value:s.customName||"",onChange:t=>h("customName",t.target.value),className:`${r.textInput}${a.customName?" "+r.inputError:""}`,placeholder:"Game Name",maxLength:26,style:{marginTop:8}}),a.customName&&e.jsx("span",{className:"errorMessage",children:a.customName})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Private Game"}),e.jsx("p",{children:"Only players with the password can join"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(w,{isChecked:s.isPrivate,onChange:t=>h("isPrivate",t.target.checked)}),s.isPrivate&&e.jsx(I,{title:"Enter Game Password",type:"text",value:s.password||"",onChange:t=>h("password",t.target.value),className:`${r.textInput}${a.password?" "+r.inputError:""}`,placeholder:"Password",maxLength:36,style:{marginTop:8}}),a.password&&e.jsx("span",{className:"errorMessage",children:a.password})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Number of Bots"}),e.jsx("p",{children:"Add AI players to your game (0-16)"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(I,{title:"Number of AI Players",type:"number",min:"0",max:"16",value:s.numberOfBots===0?"":s.numberOfBots,onChange:t=>h("numberOfBots",t.target.value===""?0:parseInt(t.target.value)||0),className:`${r.textInput} no-validation${a.numberOfBots?" "+r.inputError:""}`,placeholder:"0"}),a.numberOfBots&&e.jsx("span",{className:"errorMessage",children:a.numberOfBots})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Ante Amount"}),e.jsx("p",{children:"Set the ante amount for each round (1-100)"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(I,{title:"Ante Amount",type:"number",min:"1",max:"100",value:s.anteAmount,onChange:t=>h("anteAmount",t.target.value),className:`${r.textInput} no-validation${a.anteAmount?" "+r.inputError:""}`,placeholder:"1"}),a.anteAmount&&e.jsx("span",{className:"errorMessage",children:a.anteAmount})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Enable Ace Choice"}),e.jsx("p",{children:"Allow players to choose high/low on Ace"})]}),e.jsx("div",{className:r.settingControls,children:e.jsx(w,{isChecked:s.enableAceChoice,onChange:t=>h("enableAceChoice",t.target.checked)})})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Enable Second Chance"}),e.jsx("p",{children:"Allow players to ante up for a second chance"})]}),e.jsx("div",{className:r.settingControls,children:e.jsx(w,{isChecked:s.enableSecondChance,onChange:t=>h("enableSecondChance",t.target.checked)})})]})]})})},Ke=()=>{const{gameList:n}=z(),{user:o,logout:i}=k(),{socket:s,isConnected:x}=D();R(!0);const a=q(),[m,b]=f.useState(""),[h,y]=f.useState(!1),[t,p]=f.useState(null),c=o?.username?`user_${o.username}`:null;f.useEffect(()=>{ee().then(p)},[]),f.useEffect(()=>{if(o&&(!o.username||!o.id)){console.error("[Lobby] Invalid user data received:",o),i();return}},[o,i]);const l=g=>{!x||!o||(H.play("ui.click"),a(`/${g}`))},d=g=>{b(g.target.value)},N=g=>{if(!o?.id||!x)return;const j=_=>{s.off("gameCreated",j),_?.game?.id&&a(`/${_.game.id}`)};s.on("gameCreated",j),g?s.emit("createGame",{settings:g}):s.emit("createGame")},O=()=>N({numberOfBots:5}),M=()=>{y(!0)},T=g=>{y(!1),N(g)},B=f.useMemo(()=>{if(!n)return[];let g=n;if(m.trim()){const j=m.trim().toLowerCase();g=n.filter(_=>_.id.toLowerCase().includes(j))}return g.sort((j,_)=>{const L=j.allPlayers?.some(C=>C.userId===c),G=_.allPlayers?.some(C=>C.userId===c),P=j.disconnectedPlayers?.some(C=>C.userId===c),$=_.disconnectedPlayers?.some(C=>C.userId===c);return P&&!$?-1:!P&&$?1:L&&!G?-1:!L&&G?1:j.id.localeCompare(_.id)})},[n,m,c]);return e.jsxs("div",{className:`screen ${u.lobbyScreen}`,children:[e.jsx(F,{}),e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"1.1em",marginBottom:"-0.6em"},children:e.jsx(be,{})}),e.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"600px",marginBottom:"2rem"},children:[e.jsx(ke,{}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:u.gameActionsSection,children:[e.jsx("button",{className:"btn btn-primary",onClick:O,disabled:!o?.username,"data-gamepad-focusable":"true",children:"Create Quick Game"}),e.jsx("button",{className:"btn btn-primary",onClick:M,disabled:!o?.username,"data-gamepad-focusable":"true",children:"Create Custom Game"})]})]}),e.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"600px",minHeight:"200px"},children:[e.jsx("h2",{className:u.gameListTitle,children:"Available Games"}),e.jsx("div",{className:u.searchContainer,children:e.jsxs("div",{className:"input-with-icon",children:[e.jsx("span",{className:"input-icon left",children:"ðŸ”"}),e.jsx(I,{title:"Search Games",type:"search",className:"no-validation",placeholder:"Search games by ID",value:m,onChange:d})]})}),B&&B.length>0?e.jsx("div",{className:u.gameListWrapper,children:B.map(g=>e.jsx(Me,{game:g,onJoin:l,userId:c},g.id))}):e.jsxs("div",{className:"panel-alt",style:{textAlign:"center",padding:"2rem",minHeight:"150px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{className:u.emptyStateIcon,children:"ðŸƒ"}),e.jsx("p",{className:u.emptyStateMessage,children:m.trim()?"No matching games found":"No games in progress"}),e.jsx("p",{className:u.emptyStateHint,children:m.trim()?"Try a different search or create a new game":"Create a new game to get started!"})]})]}),h&&e.jsx(qe,{onSubmit:T,onClose:()=>y(!1)}),t&&e.jsx("div",{className:u.versionInfo,children:t.display})]})};export{Ke as default};
