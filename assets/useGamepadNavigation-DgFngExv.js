import{r as e}from"./vendor-CK21qyt8.js";const t=(t=!0)=>{const[n,o]=e.useState(null),[r,s]=e.useState([]),[a,l]=e.useState(!1),[c,i]=e.useState(!1),u=e.useRef(0),d=e.useRef({}),g=e.useCallback((()=>{if(!t)return;const e=Array.from(document.querySelectorAll('[data-gamepad-focusable="true"]:not([disabled]), [data-gamepad-scrollable="true"]')).filter((e=>{const t=e.getBoundingClientRect();if(0===t.width&&0===t.height){const t=e.closest("label")||e.closest('[class*="toggle"]')||e.parentElement;if(!t)return!1;{const e=t.getBoundingClientRect();if(0===e.width||0===e.height)return!1}}const n=document.querySelectorAll('[class*="modal"], [class*="Modal"], [role="dialog"], [class*="overlay"]');if(n.length>0){const t=Array.from(n).filter((e=>{const t=e.className;return t.includes("modal")||t.includes("Modal")||"dialog"===e.getAttribute("role")}));if(t.length>0){const n=t.sort(((e,t)=>{let n=parseInt(window.getComputedStyle(e).zIndex)||0,o=parseInt(window.getComputedStyle(t).zIndex)||0;if(0===n){const t=e.parentElement;t&&t.classList.toString().includes("overlay")&&(n=parseInt(window.getComputedStyle(t).zIndex)||0)}if(0===o){const e=t.parentElement;e&&e.classList.toString().includes("overlay")&&(o=parseInt(window.getComputedStyle(e).zIndex)||0)}return o-n}))[0];return n&&n.contains(e)}}return!0}));s((t=>t.length===e.length&&t.every(((t,n)=>t===e[n]))?t:e))}),[t]),f=e.useCallback((e=>{const t=Date.now();if(t-u.current<150)return;if(u.current=t,!r.length)return;i(!0);const s=document.activeElement;let a=n;s&&"true"===s.getAttribute("data-gamepad-focusable")&&r.includes(s)&&(a=s,o(s));const l=r.findIndex((e=>e===a));if(-1===l||!a){const e=r[0];return o(e),void e.focus()}const c=r[l];if("true"===(null==c?void 0:c.getAttribute("data-gamepad-scrollable"))&&("up"===e||"down"===e)){const t=50,n=c.scrollTop<=0,o=c.scrollTop>=c.scrollHeight-c.clientHeight;if("up"===e&&!n)return void(c.scrollTop=Math.max(0,c.scrollTop-t));if("down"===e&&!o)return void(c.scrollTop=Math.min(c.scrollHeight-c.clientHeight,c.scrollTop+t))}let d=null;if("up"===e||"down"===e){let t=null==c?void 0:c.getBoundingClientRect();if(!t)return;if(0===t.width&&0===t.height){const e=c.closest("label"),n=c.closest('[class*="toggle"]')||c.closest('[class*="Toggle"]'),o=e||n||c.parentElement;o&&(t=o.getBoundingClientRect())}const n=t.left+t.width/2,o=r.map(((e,t)=>({el:e,index:t,rect:e.getBoundingClientRect()}))).filter((({el:n,rect:o,index:r})=>r!==l&&("up"===e?o.bottom<=t.top+20:o.top>=t.bottom-20)));if(o.length>0){d=o.map((o=>({...o,horizontalDistance:Math.abs(o.rect.left+o.rect.width/2-n),verticalDistance:"up"===e?t.top-o.rect.bottom:o.rect.top-t.bottom}))).sort(((e,t)=>{const n=e.horizontalDistance-t.horizontalDistance;if(Math.abs(n)>100)return n;const o=e.verticalDistance-t.verticalDistance;return Math.abs(o)>10?o:n}))[0].el}else{const t=r.filter(((e,t)=>t!==l)).map(((e,t)=>({el:e,rect:e.getBoundingClientRect()})));if(t.length>0){const n="up"===e?0:window.innerHeight;d=t.reduce(((e,t)=>Math.abs(t.rect.top-n)<Math.abs(e.rect.top-n)?t:e)).el}else d="up"===e?r[r.length-1]:r[0]}}else{const t=null==c?void 0:c.getBoundingClientRect();if(t){const n=t.top+t.height/2,o=Math.max(t.height/2,20),s=r.map(((e,t)=>({el:e,index:t,rect:e.getBoundingClientRect()}))).filter((({rect:e,index:t})=>{const r=e.top+e.height/2;return Math.abs(r-n)<=o})).sort(((e,t)=>e.rect.left-t.rect.left)),a=s.findIndex((({el:e})=>e===c));d=-1!==a&&s.length>1?"left"===e?a>0?s[a-1].el:null:a<s.length-1?s[a+1].el:null:null}else d="left"===e?l>0?r[l-1]:r[r.length-1]:l<r.length-1?r[l+1]:r[0]}d&&(o(d),d.focus())}),[r,n]),m=e.useCallback((()=>{var e;const t="true"===(null==(e=document.activeElement)?void 0:e.getAttribute("data-gamepad-focusable"))?document.activeElement:n;t&&(i(!0),t.click())}),[n]);return e.useEffect((()=>{if(!t)return;const e=e=>{if(!(document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName))||"Enter"!==e.key)switch(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(e.key)&&e.preventDefault(),e.key){case"ArrowUp":f("up");break;case"ArrowDown":f("down");break;case"ArrowLeft":f("left");break;case"ArrowRight":f("right");break;case"Enter":case" ":m()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[f,m,t]),e.useEffect((()=>{if(!t)return;let e;const n=()=>{var t,o,r,s,a;const c=navigator.getGamepads();let i=!1;for(let e=0;e<c.length;e++){const n=c[e];if(n&&n.connected){i=!0,d.current[e]||(d.current[e]={});const l=d.current[e],c=null==(t=n.buttons[12])?void 0:t.pressed,u=null==(o=n.buttons[13])?void 0:o.pressed,g=null==(r=n.buttons[14])?void 0:r.pressed,h=null==(s=n.buttons[15])?void 0:s.pressed,p=null==(a=n.buttons[0])?void 0:a.pressed;c&&!l.up&&f("up"),u&&!l.down&&f("down"),g&&!l.left&&f("left"),h&&!l.right&&f("right"),p&&!l.a&&m(),l.up=c,l.down=u,l.left=g,l.right=h,l.a=p;const b=n.axes[0]||0,v=n.axes[1]||0,w=.3;!l.stickMoved&&(Math.abs(b)>w||Math.abs(v)>w)?(Math.abs(b)>Math.abs(v)?b>w?f("right"):b<-.3&&f("left"):v>w?f("down"):v<-.3&&f("up"),l.stickMoved=!0):Math.abs(b)<=w&&Math.abs(v)<=w&&(l.stickMoved=!1);const E=n.axes[2]||0,y=n.axes[3]||0,A=.2,M=8;if(Math.abs(y)>A){const e=y*M;window.scrollBy(0,e)}if(Math.abs(E)>A){const e=E*M;window.scrollBy(e,0)}}}l(i),e=requestAnimationFrame(n)};return n(),()=>{e&&cancelAnimationFrame(e)}}),[f,m,t]),e.useEffect((()=>{if(!t)return;const e=()=>{i(!1)};return document.addEventListener("mousemove",e),()=>document.removeEventListener("mousemove",e)}),[t]),e.useEffect((()=>(c?document.body.classList.add("gamepad-navigation-active"):document.body.classList.remove("gamepad-navigation-active"),()=>{document.body.classList.remove("gamepad-navigation-active")})),[c]),e.useEffect((()=>{if(r.length>0&&!n){const e=r[0];o(e)}}),[r.length]),e.useEffect((()=>{if(!t)return;const e=e=>{const t=e.target;t&&"true"===t.getAttribute("data-gamepad-focusable")&&(g(),setTimeout((()=>{Array.from(document.querySelectorAll('[data-gamepad-focusable="true"]:not([disabled]), [data-gamepad-scrollable="true"]')).includes(t)&&o(t)}),0))};return document.addEventListener("focus",e,!0),()=>{document.removeEventListener("focus",e,!0)}}),[t,g]),e.useEffect((()=>{if(!t)return;const e=new MutationObserver(g);return e.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-gamepad-focusable","disabled"]}),g(),()=>e.disconnect()}),[g,t]),{focusedElement:n,isGamepadConnected:a,showFocusIndicator:c,registerNavigableElements:g}};export{t as u};
