import{N as E,M as e,O as A,P as S,J as P}from"./index-rZxL1wAD.js";import{b as t,u as R}from"./vendor-ByZL_ylL.js";import{u as k}from"./useGamepadNavigation-DCsD-Nlu.js";import{s as m}from"./AuthPage.module-lHBTEcRC.js";import{A as F}from"./AppHeader-B42I-hCz.js";import"./audio-Do0jXn0P.js";import"./socket-CA1CrNgP.js";const T="_authForm_1lg5o_1",I="_errorAlert_1lg5o_95",N={authForm:T,errorAlert:I},_=({onSubmit:i,mode:s,requireEmail:o=!1,title:h=null,description:u=null})=>{const[n,d]=t.useState(""),[a,l]=t.useState(""),[p,b]=t.useState(""),[y,j]=t.useState(""),f=t.useRef(null),x=t.useRef(null),v=t.useRef(null),{enhanceInput:g}=E();t.useEffect(()=>{let r,c,w;return f.current&&(r=g(f.current,"text","Enter Username")),x.current&&(c=g(x.current,"password","Enter Password")),v.current&&o&&(w=g(v.current,"email","Enter Email")),()=>{r&&r(),c&&c(),w&&w()}},[g,o]);const C=async r=>{r.preventDefault(),j("");try{o?await i(n,a,p):await i(n,a)}catch(c){j(c.message)}};return e.jsxs("div",{className:`card ${N.authForm}`,children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontWeight:600,textAlign:"center",marginTop:0},children:h||(s==="login"?"Welcome Back":s==="migrate"?"Migrate Your Account":"Create Account")}),u&&e.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",marginBottom:"1rem"},children:u}),e.jsx("div",{className:"divider",style:{marginBottom:"1.5rem"}}),y&&e.jsx("div",{className:N.errorAlert,children:y}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"username",className:"input-label required",children:"Username"}),e.jsx("input",{ref:f,id:"username",type:"text",className:"no-validation",placeholder:"Enter your username",value:n,onChange:r=>d(r.target.value),required:!0,minLength:3,"data-gamepad-focusable":"true",autoCapitalize:"none",autoCorrect:"off",autoComplete:"username"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"password",className:"input-label required",children:"Password"}),e.jsx("input",{ref:x,id:"password",type:"password",className:"no-validation",placeholder:"Enter your password",value:a,onChange:r=>l(r.target.value),required:!0,minLength:6,"data-gamepad-focusable":"true",autoComplete:s==="login"?"current-password":"new-password"})]}),o&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"email",className:"input-label required",children:"Email"}),e.jsx("input",{ref:v,id:"email",type:"email",className:"no-validation",placeholder:"Enter your email address",value:p,onChange:r=>b(r.target.value),required:!0,"data-gamepad-focusable":"true",autoCapitalize:"none",autoCorrect:"off",autoComplete:"email"})]}),e.jsx("button",{type:"submit",className:"btn btn-primary","data-gamepad-focusable":"true",children:s==="login"?"Sign In":s==="migrate"?"Migrate Account":"Create Account"})]})]})},W=()=>{const i=R();k(!1);const[s,o]=t.useState(null),h=async(u,n,d)=>{if(!u||!n||!d)throw new Error("Username, password, and email are required");o(null);try{const a=await fetch(`${A}/auth/migrate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:u,password:n,email:d})});let l;try{l=await a.json()}catch(p){throw console.error("[Client] Error parsing response:",p),new Error("Invalid response from server")}if(!a.ok)throw new Error(l.message||"Migration failed");if(!l.customToken)throw console.error("[Client] Invalid response format: missing customToken"),new Error("Invalid server response format");await S(P,l.customToken),o("Account migrated successfully! Redirecting..."),setTimeout(()=>{i("/")},1500)}catch(a){throw console.error("[Client] Migration error:",{message:a.message}),a}};return e.jsxs("div",{className:`screen ${m.authPage}`,children:[e.jsx(F,{}),e.jsxs("div",{className:m.formContainer,children:[s&&e.jsx("div",{className:m.successAlert,children:s}),e.jsx(_,{mode:"migrate",requireEmail:!0,onSubmit:h,description:"Enter your existing username and password, plus an email address to migrate your legacy account."}),e.jsx("div",{className:m.toggleContainer,children:e.jsx("button",{className:m.toggleButton,onClick:()=>i("/auth"),"data-gamepad-focusable":"true",children:"Back to Login"})})]})]})};export{W as default};
