import{a4 as O,U as e,a5 as z,a0 as M,a6 as H,a7 as R,a8 as q,a1 as $}from"./index-boJjb72m.js";import{r as f,u as F}from"./vendor-x77BqUlH.js";import{u as J}from"./useGamepadNavigation-DduwX_rl.js";import{A as Q}from"./AppHeader-DJkLkuqI.js";import{C as V,U as Y,R as X,P as Z,S as K,a as ee,b as te,T as w,G as I}from"./GamepadInput-DAtaOwyv.js";import{g as se,o as D}from"./openInBrowser-Cnm8eseD.js";import"./audio-DijUiIHu.js";import"./socket-CA1CrNgP.js";const ae="_lobbyScreen_vk9ft_1",ne="_versionInfo_vk9ft_6",re="_legalLinks_vk9ft_16",oe="_legalLink_vk9ft_16",ie="_legalDivider_vk9ft_40",le="_gameListTitle_vk9ft_74",ce="_searchContainer_vk9ft_87",me="_gameListWrapper_vk9ft_124",de="_userDisconnectedGame_vk9ft_143",ue="_userInGame_vk9ft_150",pe="_gameListInfo_vk9ft_173",he="_gameListId_vk9ft_178",ge="_disconnectedBadge_vk9ft_187",xe="_inGameBadge_vk9ft_199",fe="_gameListPlayers_vk9ft_211",ve="_emptyStateIcon_vk9ft_278",Ne="_emptyStateMessage_vk9ft_284",_e="_emptyStateHint_vk9ft_291",je="_privatePill_vk9ft_297",be="_gameActionsSection_vk9ft_310",Ce="_gameCard_vk9ft_317",m={lobbyScreen:ae,versionInfo:ne,legalLinks:re,legalLink:oe,legalDivider:ie,gameListTitle:le,searchContainer:ce,gameListWrapper:me,userDisconnectedGame:de,userInGame:ue,gameListInfo:pe,gameListId:he,disconnectedBadge:ge,inGameBadge:xe,gameListPlayers:fe,emptyStateIcon:ve,emptyStateMessage:Ne,emptyStateHint:_e,privatePill:je,gameActionsSection:be,gameCard:Ce},ye="_pill_q09di_1",Se="_pulse_q09di_23",Ie="_text_q09di_49",L={pill:ye,pulse:Se,text:Ie},we=()=>{const{socket:n,isConnected:i}=O(),[o,s]=f.useState(null);return f.useEffect(()=>{if(!n||!i)return;n.emit("getOnlinePlayerCount",a=>{s(a)});const g=a=>s(a);return n.on("onlinePlayerCountUpdate",g),()=>{n.off("onlinePlayerCountUpdate",g)}},[n,i]),o===null?null:e.jsxs("div",{className:L.pill,children:[e.jsx("span",{className:L.pulse}),e.jsxs("span",{className:L.text,children:[o," online"]})]})},ke="_balanceSection_1ap8t_1",Le="_balanceLabel_1ap8t_10",Be="_xpSection_1ap8t_17",Ae="_xpBarContainer_1ap8t_21",Ge="_xpOverlay_1ap8t_31",Pe="_xpLevel_1ap8t_45",$e="_xpNext_1ap8t_52",De="_xpBar_1ap8t_21",j={balanceSection:ke,balanceLabel:Le,xpSection:Be,xpBarContainer:Ae,xpOverlay:Ge,xpLevel:Pe,xpNext:$e,xpBar:De},Ee=({userId:n,balance:i})=>{const o=z(n);return e.jsxs("div",{className:"panel-alt",style:{width:"100%",flex:2},children:[e.jsxs("div",{className:j.balanceSection,children:[e.jsx("span",{className:j.balanceLabel,children:"Balance:"}),e.jsx(V,{amount:Number(i)||0,size:"medium"})]}),o&&e.jsx("div",{className:j.xpSection,children:e.jsxs("div",{className:j.xpBarContainer,children:[e.jsx("div",{className:j.xpBar,style:{width:o.level>=100?"100%":`${o.percentToNextLevel||0}%`}}),e.jsxs("div",{className:j.xpOverlay,children:[e.jsxs("div",{className:j.xpLevel,children:["Level ",o.level]}),e.jsx("div",{className:j.xpNext,children:o.level<100?`${o.xpToNextLevel.toLocaleString()} XP`:"MAX"})]})]})})]})},Oe="_userSection_53k67_2",Me="_avatarContainer_53k67_12",Te="_headerButtons_53k67_16",Ue="_logoutButton_53k67_40",S={userSection:Oe,avatarContainer:Me,headerButtons:Te,logoutButton:Ue},We=()=>{const{user:n,logout:i,refreshUserData:o}=M(),[s,g]=f.useState(!1);return e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{className:`panel ${S.userSection}`,children:[e.jsx("div",{className:S.avatarContainer,children:e.jsx(Y,{userId:n?.id,size:"medium",showName:!0,namePosition:"right"})}),e.jsx(Ee,{userId:n?.id,balance:n?.balance}),e.jsxs("div",{className:S.headerButtons,children:[e.jsx("button",{className:S.logoutButton,onClick:i,"data-gamepad-focusable":"true",children:e.jsx("span",{className:S.buttonText,children:"Logout"})}),e.jsx(X,{"data-gamepad-focusable":"true"}),e.jsx(Z,{"data-gamepad-focusable":"true"}),e.jsx(K,{onClick:()=>g(!0),"data-gamepad-focusable":"true"}),e.jsx(ee,{"data-gamepad-focusable":"true"})]})]}),s&&e.jsx(te,{onClose:()=>{g(!1),o&&o()}})]})},ze=({className:n="",width:i="1em",height:o="1em",...s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`feather feather-lock ${n}`,width:i,height:o,...s,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]});function He({game:n,onJoin:i,userId:o}){const s=n.settings?.customName||`Game ${n.id}`,g=n.disconnectedPlayers?.some(h=>h.userId===o),a=n.allPlayers?.some(h=>h.userId===o&&!h.disconnected);let d="Join";g?d="Reconnect":a&&(d="Continue");let b=`panel ${m.gameCard}`;return g?b+=` ${m.userDisconnectedGame}`:a&&(b+=` ${m.userInGame}`),e.jsxs("div",{className:b,children:[" ",e.jsxs("div",{className:m.gameListInfo,style:{flex:1},children:[e.jsxs("div",{className:m.gameListId,children:[" ",s,n.settings?.isPrivate&&e.jsxs("span",{className:m.privatePill,title:"Private Game",children:[e.jsx(ze,{width:"0.9em",height:"0.9em",style:{marginRight:"4px",verticalAlign:"middle"}}),"Private"]}),g&&e.jsx("span",{className:m.disconnectedBadge,title:"You're disconnected from this game",children:"âš ï¸ Reconnect"}),a&&e.jsx("span",{className:m.inGameBadge,title:"You're in this game",children:"You're In"})]}),e.jsxs("div",{className:m.gameListPlayers,children:[" ",n.playerCount," ",n.playerCount===1?"player":"players"]})]}),e.jsx("button",{className:"btn btn-primary",style:{padding:"0.4rem 1rem",fontSize:"0.9rem",minWidth:"80px",maxWidth:"100px",flexShrink:0},onClick:()=>i(n.id),disabled:!o,"data-gamepad-focusable":"true",children:d})]})}const Re="_gameSettingItem_tzwbj_1",qe="_settingDescription_tzwbj_13",Fe="_settingControls_tzwbj_35",Je="_textInput_tzwbj_42",Qe="_inputError_tzwbj_60",r={gameSettingItem:Re,settingDescription:qe,settingControls:Fe,textInput:Je,inputError:Qe},E={useCustomName:!1,customName:"",isPrivate:!1,password:"",enableAceChoice:!0,enableSecondChance:!0,numberOfBots:0,anteAmount:""},Ve=({initialSettings:n=E,onSubmit:i,onClose:o})=>{const[s,g]=f.useState({...E,...n}),[a,d]=f.useState({}),b=t=>{const p={};if(t.useCustomName){const u=t.customName||"";u?u.length<4||u.length>26?p.customName="Name must be 4-26 characters.":/^[a-zA-Z0-9_-]+$/.test(u)||(p.customName="Use letters, numbers, -, or _."):p.customName="Custom name is required."}if(t.isPrivate){const u=t.password||"";u?(u.length<3||u.length>36)&&(p.password="Password must be 3-36 characters."):p.password="Password is required."}const l=t.numberOfBots;(l<0||l>16)&&(p.numberOfBots="Number of bots must be between 0 and 16.");const c=t.anteAmount;if(c!==""&&c!==null&&c!==void 0){const u=parseInt(c);(isNaN(u)||u<1||u>100)&&(p.anteAmount="Ante amount must be between 1 and 100.")}return p},h=(t,p)=>{g(l=>{const c={...l,[t]:p};return t==="useCustomName"&&!p&&(c.customName="",a.customName&&d(u=>{const v={...u};return delete v.customName,v})),t==="isPrivate"&&!p&&(c.password="",a.password&&d(u=>{const v={...u};return delete v.password,v})),c}),(t==="customName"||t==="useCustomName")&&a.customName&&d(l=>{const c={...l};return delete c.customName,c}),(t==="password"||t==="isPrivate")&&a.password&&d(l=>{const c={...l};return delete c.password,c}),t==="numberOfBots"&&a.numberOfBots&&d(l=>{const c={...l};return delete c.numberOfBots,c}),t==="anteAmount"&&a.anteAmount&&d(l=>{const c={...l};return delete c.anteAmount,c})},y=t=>{t.preventDefault();const p=b(s);if(Object.keys(p).length>0)d(p);else{d({});const l={...s,customName:s.useCustomName?s.customName:null,anteAmount:s.anteAmount===""?1:parseInt(s.anteAmount)};delete l.useCustomName,i(l)}};return e.jsx(H,{title:"Game Options",onClose:o,style:{maxWidth:600},footer:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:o,className:"btn btn-secondary","data-gamepad-focusable":"true",children:"Cancel"}),e.jsx("button",{type:"submit",form:"gameSettingsForm",className:"btn btn-primary",disabled:Object.keys(a).length>0,"data-gamepad-focusable":"true",children:"Create Game"})]}),children:e.jsxs("form",{id:"gameSettingsForm",onSubmit:y,children:[e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Custom Game Name"}),e.jsx("p",{children:"Set a custom name for your game lobby"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(w,{isChecked:s.useCustomName,onChange:t=>h("useCustomName",t.target.checked)}),s.useCustomName&&e.jsx(I,{title:"Enter Game Name",type:"text",value:s.customName||"",onChange:t=>h("customName",t.target.value),className:`${r.textInput}${a.customName?" "+r.inputError:""}`,placeholder:"Game Name",maxLength:26,style:{marginTop:8}}),a.customName&&e.jsx("span",{className:"errorMessage",children:a.customName})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Private Game"}),e.jsx("p",{children:"Only players with the password can join"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(w,{isChecked:s.isPrivate,onChange:t=>h("isPrivate",t.target.checked)}),s.isPrivate&&e.jsx(I,{title:"Enter Game Password",type:"text",value:s.password||"",onChange:t=>h("password",t.target.value),className:`${r.textInput}${a.password?" "+r.inputError:""}`,placeholder:"Password",maxLength:36,style:{marginTop:8}}),a.password&&e.jsx("span",{className:"errorMessage",children:a.password})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Number of Bots"}),e.jsx("p",{children:"Add AI players to your game (0-16)"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(I,{title:"Number of AI Players",type:"number",min:"0",max:"16",value:s.numberOfBots===0?"":s.numberOfBots,onChange:t=>h("numberOfBots",t.target.value===""?0:parseInt(t.target.value)||0),className:`${r.textInput} no-validation${a.numberOfBots?" "+r.inputError:""}`,placeholder:"0"}),a.numberOfBots&&e.jsx("span",{className:"errorMessage",children:a.numberOfBots})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Ante Amount"}),e.jsx("p",{children:"Set the ante amount for each round (1-100)"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(I,{title:"Ante Amount",type:"number",min:"1",max:"100",value:s.anteAmount,onChange:t=>h("anteAmount",t.target.value),className:`${r.textInput} no-validation${a.anteAmount?" "+r.inputError:""}`,placeholder:"1"}),a.anteAmount&&e.jsx("span",{className:"errorMessage",children:a.anteAmount})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Enable Ace Choice"}),e.jsx("p",{children:"Allow players to choose high/low on Ace"})]}),e.jsx("div",{className:r.settingControls,children:e.jsx(w,{isChecked:s.enableAceChoice,onChange:t=>h("enableAceChoice",t.target.checked)})})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Enable Second Chance"}),e.jsx("p",{children:"Allow players to ante up for a second chance"})]}),e.jsx("div",{className:r.settingControls,children:e.jsx(w,{isChecked:s.enableSecondChance,onChange:t=>h("enableSecondChance",t.target.checked)})})]})]})})},nt=()=>{const{gameList:n}=R(),{user:i,logout:o}=M(),{socket:s,isConnected:g}=O();J(!0);const a=F(),[d,b]=f.useState(""),[h,y]=f.useState(!1),[t,p]=f.useState(null),l=i?.id||null;f.useEffect(()=>{se().then(p)},[]),f.useEffect(()=>{if(i&&(!i.username||!i.id)){console.error("[Lobby] Invalid user data received:",i),o();return}},[i,o]);const c=x=>{!g||!i||(q.play("ui.click"),a(`/${x}`))},u=x=>{b(x.target.value)},v=x=>{if(!i?.id||!g)return;const N=_=>{s.off("gameCreated",N),_?.game?.id&&a(`/${_.game.id}`)};s.on("gameCreated",N),x?s.emit("createGame",{settings:x}):s.emit("createGame")},T=()=>v({numberOfBots:5}),U=()=>{y(!0)},W=x=>{y(!1),v(x)},k=f.useMemo(()=>{if(!n)return[];let x=n;if(d.trim()){const N=d.trim().toLowerCase();x=n.filter(_=>_.id.toLowerCase().includes(N))}return x.sort((N,_)=>{const B=N.allPlayers?.some(C=>C.userId===l),A=_.allPlayers?.some(C=>C.userId===l),G=N.disconnectedPlayers?.some(C=>C.userId===l),P=_.disconnectedPlayers?.some(C=>C.userId===l);return G&&!P?-1:!G&&P?1:B&&!A?-1:!B&&A?1:N.id.localeCompare(_.id)})},[n,d,l]);return e.jsxs("div",{className:`screen app-gradient-bg ${m.lobbyScreen}`,children:[e.jsx(Q,{}),e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"1.1em",marginBottom:"-0.6em"},children:e.jsx(we,{})}),e.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"600px",marginBottom:"2rem"},children:[e.jsx(We,{}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:m.gameActionsSection,children:[e.jsx("button",{className:"btn btn-primary",onClick:T,disabled:!i?.username,"data-gamepad-focusable":"true",children:"Create Quick Game"}),e.jsx("button",{className:"btn btn-primary",onClick:U,disabled:!i?.username,"data-gamepad-focusable":"true",children:"Create Custom Game"})]})]}),e.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"600px",minHeight:"200px"},children:[e.jsx("h2",{className:m.gameListTitle,children:"Available Games"}),e.jsx("div",{className:m.searchContainer,children:e.jsxs("div",{className:"input-with-icon",children:[e.jsx("span",{className:"input-icon left",children:"ðŸ”"}),e.jsx(I,{title:"Search Games",type:"search",className:"no-validation",placeholder:"Search games by ID",value:d,onChange:u})]})}),k&&k.length>0?e.jsx("div",{className:m.gameListWrapper,children:k.map(x=>e.jsx(He,{game:x,onJoin:c,userId:l},x.id))}):e.jsxs("div",{className:"panel-alt",style:{textAlign:"center",padding:"2rem",minHeight:"150px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{className:m.emptyStateIcon,children:"ðŸƒ"}),e.jsx("p",{className:m.emptyStateMessage,children:d.trim()?"No matching games found":"No games in progress"}),e.jsx("p",{className:m.emptyStateHint,children:d.trim()?"Try a different search or create a new game":"Create a new game to get started!"})]})]}),h&&e.jsx(Ve,{onSubmit:W,onClose:()=>y(!1)}),t&&e.jsxs("div",{className:m.versionInfo,children:[e.jsxs("div",{className:m.legalLinks,children:[e.jsx("button",{onClick:()=>D(`${$}/terms`),className:m.legalLink,children:"Terms of Service"}),e.jsx("span",{className:m.legalDivider,children:"â€¢"}),e.jsx("button",{onClick:()=>D(`${$}/privacy`),className:m.legalLink,children:"Privacy Policy"})]}),e.jsx("div",{children:t.display})]})]})};export{nt as default};
