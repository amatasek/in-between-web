import{j as e,u as s,I as a}from"./ui-DgYMOojV.js";import{r as t,u as n}from"./vendor-BoU4GIkp.js";import{a as r,b as i,B as o,c as l,u as c,d,s as m}from"./index-Crscu569.js";import{u}from"./useGamepadNavigation-Kc11nJyB.js";import{A as h,G as v}from"./AppHeader-YOH8PSJZ.js";import{C as x,T as _,G as p,U as g,R as j,P as N,S as C,a as b,b as f}from"./StoreModal-8NZwfmS5.js";const y="_lobbyContainer_1v9ur_1",B="_gameListContainer_1v9ur_90",w="_gameListTitle_1v9ur_115",I="_searchContainer_1v9ur_128",P="_searchIcon_1v9ur_170",S="_gameListWrapper_1v9ur_175",$="_gameListItem_1v9ur_181",k="_userDisconnectedGame_1v9ur_194",G="_userInGame_1v9ur_201",L="_gameListInfo_1v9ur_224",O="_gameListId_1v9ur_229",A="_disconnectedBadge_1v9ur_238",q="_inGameBadge_1v9ur_250",D="_gameListPlayers_1v9ur_262",E="_joinGameButton_1v9ur_268",T="_reconnectButton_1v9ur_279",M="_continueButton_1v9ur_290",U="_emptyGameList_1v9ur_316",z="_emptyStateIcon_1v9ur_329",F="_emptyStateMessage_1v9ur_335",R="_emptyStateHint_1v9ur_342",W="_privatePill_1v9ur_348",J="_pill_1hv5h_1",Y="_pulse_1hv5h_22",H="_text_1hv5h_48",X=()=>{const{socket:s,isConnected:a}=r(),[n,i]=t.useState(null);return t.useEffect((()=>{if(!s||!a)return;s.emit("getOnlinePlayerCount",(e=>{i(e)}));const e=e=>i(e);return s.on("onlinePlayerCountUpdate",e),()=>{s.off("onlinePlayerCountUpdate",e)}}),[s,a]),null===n?null:e.jsxs("div",{className:J,children:[e.jsx("span",{className:Y}),e.jsxs("span",{className:H,children:[n," online"]})]})},Q="_progressInfoContainer_nucsq_1",V="_balanceSection_nucsq_13",Z="_balanceLabel_nucsq_22",K="_xpSection_nucsq_29",ee="_xpBarContainer_nucsq_33",se="_xpOverlay_nucsq_43",ae="_xpLevel_nucsq_57",te="_xpNext_nucsq_64",ne="_xpBar_nucsq_33",re=({userId:s,balance:a})=>{const t=i(s);return e.jsxs("div",{className:Q,children:[e.jsxs("div",{className:V,children:[e.jsx("span",{className:Z,children:"Balance:"}),e.jsx(x,{amount:Number(a)||0,size:"medium"})]}),t&&e.jsx("div",{className:K,children:e.jsxs("div",{className:ee,children:[e.jsx("div",{className:ne,style:{width:t.level>=100?"100%":`${t.percentToNextLevel||0}%`}}),e.jsxs("div",{className:se,children:[e.jsxs("div",{className:ae,children:["Level ",t.level]}),e.jsx("div",{className:te,children:t.level<100?`${t.xpToNextLevel.toLocaleString()} XP`:"MAX"})]})]})})]})},ie={playerPanel:"_playerPanel_1e2ac_1",userSection:"_userSection_1e2ac_28",avatarContainer:"_avatarContainer_1e2ac_43",headerButtons:"_headerButtons_1e2ac_47",logoutButton:"_logoutButton_1e2ac_77",divider:"_divider_1e2ac_116",actionSection:"_actionSection_1e2ac_124",actionButton:"_actionButton_1e2ac_131",createButton:"_createButton_1e2ac_156",cancelButton:"_cancelButton_1e2ac_173"},oe={useCustomName:!1,customName:"",isPrivate:!1,password:"",enableAceChoice:!0,enableSecondChance:!0,numberOfBots:0},le=({initialSettings:s=oe,onSubmit:a,onClose:n})=>{const[r,i]=t.useState({...oe,...s}),[c,d]=t.useState({}),m=(e,s)=>{i((a=>{const t={...a,[e]:s};return"useCustomName"!==e||s||(t.customName="",c.customName&&d((e=>{const s={...e};return delete s.customName,s}))),"isPrivate"!==e||s||(t.password="",c.password&&d((e=>{const s={...e};return delete s.password,s}))),t})),"customName"!==e&&"useCustomName"!==e||!c.customName||d((e=>{const s={...e};return delete s.customName,s})),"password"!==e&&"isPrivate"!==e||!c.password||d((e=>{const s={...e};return delete s.password,s})),"numberOfBots"===e&&c.numberOfBots&&d((e=>{const s={...e};return delete s.numberOfBots,s}))};return e.jsx(o,{title:"Game Options",onClose:n,style:{maxWidth:600},footer:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:n,className:`${ie.actionButton} ${ie.cancelButton}`,"data-gamepad-focusable":"true",children:"Cancel"}),e.jsx("button",{type:"submit",form:"gameSettingsForm",className:`${ie.actionButton} ${ie.createButton}`,disabled:Object.keys(c).length>0,"data-gamepad-focusable":"true",children:"Create Game"})]}),children:e.jsx("form",{id:"gameSettingsForm",onSubmit:e=>{e.preventDefault();const s=(e=>{const s={};if(e.useCustomName){const a=e.customName||"";a?a.length<4||a.length>26?s.customName="Name must be 4-26 characters.":/^[a-zA-Z0-9_-]+$/.test(a)||(s.customName="Use letters, numbers, -, or _."):s.customName="Custom name is required."}if(e.isPrivate){const a=e.password||"";a?(a.length<3||a.length>36)&&(s.password="Password must be 3-36 characters."):s.password="Password is required."}const a=e.numberOfBots;return(a<0||a>16)&&(s.numberOfBots="Number of bots must be between 0 and 16."),s})(r);if(Object.keys(s).length>0)d(s);else{d({});const e={...r,customName:r.useCustomName?r.customName:null};delete e.useCustomName,a(e)}},children:e.jsxs("div",{className:l.settingsContainer,children:[e.jsxs("div",{className:l.settingItem,children:[e.jsxs("div",{className:l.settingDescription,children:[e.jsx("h4",{children:"Custom Game Name"}),e.jsx("p",{children:"Set a custom name for your game lobby"})]}),e.jsxs("div",{className:l.settingControls,children:[e.jsx(_,{isChecked:r.useCustomName,onChange:e=>m("useCustomName",e.target.checked)}),r.useCustomName&&e.jsx(p,{title:"Enter Game Name",type:"text",value:r.customName||"",onChange:e=>m("customName",e.target.value),className:`${l.textInput}${c.customName?" "+l.inputError:""}`,placeholder:"Game Name",maxLength:26,autoFocus:!0,style:{marginTop:8}}),c.customName&&e.jsx("span",{className:"errorMessage",children:c.customName})]})]}),e.jsxs("div",{className:l.settingItem,children:[e.jsxs("div",{className:l.settingDescription,children:[e.jsx("h4",{children:"Private Game"}),e.jsx("p",{children:"Only players with the password can join"})]}),e.jsxs("div",{className:l.settingControls,children:[e.jsx(_,{isChecked:r.isPrivate,onChange:e=>m("isPrivate",e.target.checked)}),r.isPrivate&&e.jsx(p,{title:"Enter Game Password",type:"password",value:r.password||"",onChange:e=>m("password",e.target.value),className:`${l.textInput}${c.password?" "+l.inputError:""}`,placeholder:"Password",maxLength:36,autoFocus:r.isPrivate&&!r.useCustomName,style:{marginTop:8}}),c.password&&e.jsx("span",{className:"errorMessage",children:c.password})]})]}),e.jsxs("div",{className:l.settingItem,children:[e.jsxs("div",{className:l.settingDescription,children:[e.jsx("h4",{children:"Number of Bots"}),e.jsx("p",{children:"Add AI players to your game (0-16)"})]}),e.jsxs("div",{className:l.settingControls,children:[e.jsx(p,{title:"Number of AI Players",type:"number",min:"0",max:"16",value:r.numberOfBots,onChange:e=>m("numberOfBots",parseInt(e.target.value)||0),className:`${l.textInput}${c.numberOfBots?" "+l.inputError:""}`}),c.numberOfBots&&e.jsx("span",{className:"errorMessage",children:c.numberOfBots})]})]}),e.jsxs("div",{className:l.settingItem,children:[e.jsxs("div",{className:l.settingDescription,children:[e.jsx("h4",{children:"Enable Ace Choice"}),e.jsx("p",{children:"Allow players to choose high/low on Ace"})]}),e.jsx("div",{className:l.settingControls,children:e.jsx(_,{isChecked:r.enableAceChoice,onChange:e=>m("enableAceChoice",e.target.checked)})})]}),e.jsxs("div",{className:l.settingItem,children:[e.jsxs("div",{className:l.settingDescription,children:[e.jsx("h4",{children:"Enable Second Chance"}),e.jsx("p",{children:"Allow players to ante up for a second chance"})]}),e.jsx("div",{className:l.settingControls,children:e.jsx(_,{isChecked:r.enableSecondChance,onChange:e=>m("enableSecondChance",e.target.checked)})})]})]})})})},ce=()=>{const{user:s,logout:a,refreshUserData:i}=c(),{socket:o,isConnected:l}=r(),d=n(),[m,u]=t.useState(!1),[h,v]=t.useState(!1),x=e=>{if(!(null==s?void 0:s.id)||!l)return;const a=e=>{var s;o.off("gameCreated",a),(null==(s=null==e?void 0:e.game)?void 0:s.id)&&d(`/${e.game.id}`)};o.on("gameCreated",a),e?o.emit("createGame",{settings:e}):o.emit("createGame")};return e.jsxs("div",{className:ie.playerPanel,children:[e.jsxs("div",{className:ie.userSection,children:[e.jsx("div",{className:ie.avatarContainer,children:e.jsx(g,{userId:null==s?void 0:s.id,size:"medium",showName:!0,namePosition:"right"})}),e.jsx(re,{userId:null==s?void 0:s.id,balance:null==s?void 0:s.balance}),e.jsxs("div",{className:ie.headerButtons,children:[e.jsx("button",{className:ie.logoutButton,onClick:a,"data-gamepad-focusable":"true",children:e.jsx("span",{className:ie.buttonText,children:"Logout"})}),e.jsx(j,{"data-gamepad-focusable":"true"}),e.jsx(N,{"data-gamepad-focusable":"true"}),e.jsx(C,{onClick:()=>v(!0),"data-gamepad-focusable":"true"}),e.jsx(b,{"data-gamepad-focusable":"true"})]})]}),e.jsx("div",{className:ie.divider}),e.jsxs("div",{className:ie.actionSection,children:[e.jsx("button",{className:`${ie.actionButton} ${ie.createButton}`,onClick:()=>x({numberOfBots:5}),disabled:!(null==s?void 0:s.username),"data-gamepad-focusable":"true",children:"Create Quick Game"}),e.jsx("button",{className:`${ie.actionButton} ${ie.createButton}`,onClick:()=>{u(!0)},disabled:!(null==s?void 0:s.username),"data-gamepad-focusable":"true",children:"Create Custom Game"})]}),m&&e.jsx(le,{onSubmit:e=>{u(!1),x(e)},onClose:()=>u(!1)}),h&&e.jsx(f,{onClose:()=>{v(!1),i&&i()}})]})},de=({className:s="",width:a="1em",height:t="1em",...n})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`feather feather-lock ${s}`,width:a,height:t,...n,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]});function me({game:s,onJoin:a,userId:t}){var n,r,i,o;const l=(null==(n=s.settings)?void 0:n.customName)||`Game ${s.id}`,c=null==(r=s.disconnectedPlayers)?void 0:r.some((e=>e.userId===t)),d=null==(i=s.allPlayers)?void 0:i.some((e=>e.userId===t&&!e.disconnected));let m="Join",u=E;c?(m="Reconnect",u+=` ${T}`):d&&(m="Continue",u+=` ${M}`);let h=$;return c?h+=` ${k}`:d&&(h+=` ${G}`),e.jsxs("div",{className:h,children:[" ",e.jsxs("div",{className:L,children:[e.jsxs("div",{className:O,children:[" ",l,(null==(o=s.settings)?void 0:o.isPrivate)&&e.jsxs("span",{className:W,title:"Private Game",children:[e.jsx(de,{width:"0.9em",height:"0.9em",style:{marginRight:"4px",verticalAlign:"middle"}}),"Private"]}),c&&e.jsx("span",{className:A,title:"You're disconnected from this game",children:"‚ö†Ô∏è Reconnect"}),d&&e.jsx("span",{className:q,title:"You're in this game",children:"You're In"})]}),e.jsxs("div",{className:D,children:[" ",s.playerCount," ",1===s.playerCount?"player":"players"]})]}),e.jsx("button",{className:u,onClick:()=>a(s.id),disabled:!t,"data-gamepad-focusable":"true",children:m})]})}const ue=()=>{const{gameList:o,loading:l}=d(),{user:x,logout:_}=c();i(null==x?void 0:x.id);const{isConnected:p}=r();u(!0);const g=n(),[j,N]=t.useState("");s("(max-width:600px)");const C=s("(max-width:400px)"),b=(null==x?void 0:x.username)?`user_${x.username}`:null;t.useEffect((()=>{if(x)return x.username&&x.id?void 0:(console.error("[Lobby] Invalid user data received:",x),void _())}),[x,_]);const f=e=>{p&&x&&(m.play("ui.click"),g(`/${e}`))},$=t.useMemo((()=>{if(!o)return[];let e=o;if(j.trim()){const s=j.trim().toLowerCase();e=o.filter((e=>e.id.toLowerCase().includes(s)))}return e.sort(((e,s)=>{var a,t,n,r;const i=null==(a=e.allPlayers)?void 0:a.some((e=>e.userId===b)),o=null==(t=s.allPlayers)?void 0:t.some((e=>e.userId===b)),l=null==(n=e.disconnectedPlayers)?void 0:n.some((e=>e.userId===b)),c=null==(r=s.disconnectedPlayers)?void 0:r.some((e=>e.userId===b));return l&&!c?-1:!l&&c?1:i&&!o?-1:!i&&o?1:e.id.localeCompare(s.id)}))}),[o,j,b]);return e.jsxs("div",{className:y,children:[e.jsx(h,{}),e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"1.1em",marginBottom:"-0.6em"},children:e.jsx(X,{})}),e.jsx(ce,{}),e.jsxs("div",{className:B,children:[e.jsx("h2",{className:w,children:"Available Games"}),e.jsx("div",{className:I,children:e.jsx(v,{title:"Search Games",placeholder:"Search games by ID",variant:"outlined",fullWidth:!0,value:j,onChange:e=>{N(e.target.value)},size:C?"small":"medium",type:"text",InputProps:{startAdornment:e.jsx(a,{position:"start",children:e.jsx("span",{className:P,children:"üîç"})})}})}),$&&$.length>0?e.jsx("div",{className:S,children:$.map((s=>e.jsx(me,{game:s,onJoin:f,userId:b},s.id)))}):e.jsxs("div",{className:U,children:[e.jsx("div",{className:z,children:"üÉè"}),e.jsx("p",{className:F,children:j.trim()?"No matching games found":"No games in progress"}),e.jsx("p",{className:R,children:j.trim()?"Try a different search or create a new game":"Create a new game to get started!"})]})]})]})};export{ue as default};
//# sourceMappingURL=Lobby-DuK_sSul.js.map
