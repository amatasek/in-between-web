const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AuthPage-Br4IYKfp.js","assets/react-LCTZrjTk.js","assets/vendor-DCzzBhLE.js","assets/socket-DDuR0C0b.js","assets/AppHeader-CCcL-V-p.js","assets/mui-BSPbzN1w.js","assets/AppHeader-BK9ybMct.css","assets/useGamepadNavigation-B8bT5PUC.js","assets/AuthPage-C81TTBkJ.css","assets/Lobby-BbmheIXp.js","assets/StoreModal-CZDMgHej.js","assets/StoreModal-BAsCbv4F.css","assets/Lobby-D1K9TVYt.css","assets/GameRoom-DTxNe_WQ.js","assets/GameRoom-vffvVCbz.css"])))=>i.map(i=>d[i]);
import{j as e,r as t,g as n,N as r,d as s,h as o,i as a,l as i}from"./react-LCTZrjTk.js";import{B as c}from"./vendor-DCzzBhLE.js";import{l}from"./socket-DDuR0C0b.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const u=new class{constructor(){this.sounds={},this.muted=!1,this.initialized=!1,this.categories=["ui"],this.lastPlayedTime={},this.debounceTime=500,this.audioUnlocked=!1,this.API_URL="https://api.in-between.live","undefined"!=typeof window&&setTimeout((()=>{this.initialize(),this._setupMobileAudioUnlock()}),0)}initialize(){this.initialized||(this.loadCategory("ui"),this.initialized=!0)}loadCategory(e){if(this.sounds[e])return;const t={};"ui"===e&&(t.join=[0,500],t.leave=[500,1e3],t.alert=[1500,1500]),this.sounds[e]=new c.Howl({src:[`${this.API_URL}/assets/audio/${e}-sounds.mp3`,`${this.API_URL}/assets/audio/${e}-sounds.webm`],sprite:t,preload:!0,html5:this._isMobileDevice(),format:["mp3","webm"],pool:10})}play(e,t=1){if(this.muted)return;let n,r;if(this.initialized||this.initialize(),e.includes(".")?[n,r]=e.split("."):(n="ui",r=e),!this.sounds[n])return void this.loadCategory(n);const s=`${n}.${r}`,o=Date.now();return o-(this.lastPlayedTime[s]||0)<this.debounceTime?void 0:(this.lastPlayedTime[s]=o,this.sounds[n].volume(t),this.sounds[n].play(r))}setMuted(e){this.muted=e,Object.values(this.sounds).forEach((t=>{t&&t.mute&&t.mute(e)}))}syncWithPreferences(e){e&&void 0!==e.muted&&this.setMuted(e.muted)}_setupMobileAudioUnlock(){if("undefined"==typeof window||!this._isMobileDevice())return;const e=()=>{if(this.audioUnlocked)return;const t=new Audio;t.src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABIgD///////////////////////////////////////////8AAAA8TEFNRTMuMTAwAQAAAAAAAAAAABSAJAJAQgAAgAAAAiIkfC3/////////////////////",t.load(),t.play().then((()=>{this.audioUnlocked=!0,document.body.removeEventListener("touchstart",e),document.body.removeEventListener("touchend",e),document.body.removeEventListener("click",e)})).catch((e=>{}))};document.body.addEventListener("touchstart",e,!1),document.body.addEventListener("touchend",e,!1),document.body.addEventListener("click",e,!1)}_isMobileDevice(){return"undefined"!=typeof navigator&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)}},d={},p=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=e?.nonce||e?.getAttribute("nonce");r=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in d)return;d[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),t?new Promise(((t,n)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)}))},h="_loadingScreen_16l5s_1",m="_loadingContainer_16l5s_10",f="_spinner_16l5s_21",b="_message_16l5s_31",y=({message:t="Loading..."})=>e.jsx("div",{className:h,children:e.jsxs("div",{className:m,children:[e.jsx("div",{className:f}),e.jsx("p",{className:b,children:t})]})}),A="https://api.in-between.live",_=t.createContext(),w=()=>t.useContext(_),g=({children:n})=>{const{token:r}=k(),[s,o]=t.useState(null),[a,i]=t.useState(!1),[c,u]=t.useState(null);t.useEffect((()=>{if("undefined"==typeof window)return;if(!r)return void(s&&(s.disconnect(),o(null),i(!1),u(null)));const e=l("https://api.in-between.live",{auth:{token:r},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,transports:["websocket","polling"],timeout:1e4});o(e),e.on("connect",(()=>{u(null)})),e.on("authenticated",(t=>{e.auth={userId:t.userId,username:t.username},i(!0),e.emit("getGameList")})),e.on("connect_error",(e=>{u("Failed to connect to game server: "+e.message),i(!1)})),e.on("disconnect",(()=>{i(!1)})),e.on("error",(e=>{u(e.message||"Unknown socket error")}));const t=["connect","authenticated","disconnect","connect_error","error","transport"];return()=>{e&&(t.forEach((t=>e.off(t))),e.disconnect(),o(null),i(!1),u(null))}}),[r]);const d={socket:s,isConnected:a,error:c,setError:u};return e.jsx(_.Provider,{value:d,children:n})},v=t.createContext(null),j=({children:n})=>{const[r,s]=t.useState(null),[o,a]=t.useState(null),[i,c]=t.useState(!0),[l,u]=t.useState(!1),d=w(),p=d?.socket;t.useEffect((()=>{if(p&&r)return p.on("balanceUpdated",(e=>{if(e&&"number"==typeof e.balance){const t={...r,balance:e.balance};s(t)}})),()=>{p.off("balanceUpdated")}}),[p,r]);const h=async e=>{try{if(!e)return null;const t=await fetch(`${A}/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch user data");return(await t.json()).user}catch(t){return null}};t.useEffect((()=>{(async()=>{let e=null;try{e=localStorage.getItem("token"),e&&a(e)}catch(t){localStorage.removeItem("token")}if(e)try{const t=await h(e);t?s(t):(s(null),a(null),localStorage.removeItem("token"))}catch(t){s(null),a(null),localStorage.removeItem("token")}finally{c(!1)}else s(null),a(null),c(!1)})()}),[]);const m=t.useCallback((()=>{s(null),a(null),u(!1),localStorage.removeItem("token")}),[]),f=t.useCallback((async()=>{try{const e=await h(o);e?s(e):m()}catch(e){m()}}),[o,m]);return i?null:e.jsx(v.Provider,{value:{user:r,token:o,login:async(e,t)=>{if(!e||!e.username||!e.id||"number"!=typeof e.balance)throw new Error("Invalid user data provided");if(!t)throw new Error("No authentication token provided");try{const n={username:e.username,id:e.id,balance:e.balance};s(n),a(t),localStorage.setItem("token",t),u(!0);const r=await h(t);r&&s(r)}catch(n){throw n}},logout:m,refreshUserData:f,loading:i},children:n})},k=()=>{const e=t.useContext(v);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},x=t.createContext(),S=()=>t.useContext(x),E=({children:n})=>{const{socket:r,isConnected:s}=w(),[o,a]=t.useState([]),[i,c]=t.useState(!0),[l,u]=t.useState(null);t.useEffect((()=>{if(!r||!s)return;const e=e=>{a(e),c(!1)},t=e=>{u(e.message||"An error occurred"),c(!1)};return r.on("gameList",e),r.on("error",t),r.emit("getGameList"),()=>{r.off("gameList",e),r.off("error",t)}}),[r,s]);const d={gameList:o,loading:i,error:l};return e.jsx(x.Provider,{value:d,children:n})},C=t.lazy((()=>p((()=>import("./AuthPage-Br4IYKfp.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8])))),P=t.lazy((()=>p((()=>import("./Lobby-BbmheIXp.js")),__vite__mapDeps([9,1,2,3,7,4,5,6,10,11,12])))),I=t.lazy((()=>p((()=>import("./GameRoom-DTxNe_WQ.js")),__vite__mapDeps([13,1,2,3,10,11,7,14])))),T=({children:t})=>{const{user:n,loading:s}=k();return s?e.jsx(y,{message:"Checking authentication..."}):n?t:e.jsx(r,{to:"/auth",replace:!0})},$=n([{path:"/",element:e.jsx(T,{children:e.jsx(E,{children:e.jsx(t.Suspense,{fallback:e.jsx(y,{message:"Loading..."}),children:e.jsx(P,{})})})})},{path:"/auth",element:e.jsx(t.Suspense,{fallback:e.jsx(y,{message:"Loading..."}),children:e.jsx(C,{})})},{path:"/:gameId",element:e.jsx(T,{children:e.jsx(t.Suspense,{fallback:e.jsx(y,{message:"Loading..."}),children:e.jsx(I,{})})})},{path:"*",element:e.jsx(r,{to:"/",replace:!0})}]),N={overlay:"_overlay_j8a1u_1",modal:"_modal_j8a1u_17",header:"_header_j8a1u_38",closeButton:"_closeButton_j8a1u_55",sectionHeader:"_sectionHeader_j8a1u_74",settingItem:"_settingItem_j8a1u_90",settingControls:"_settingControls_j8a1u_106",primaryButton:"_primaryButton_j8a1u_113",settingDescription:"_settingDescription_j8a1u_135",textInput:"_textInput_j8a1u_157",inputError:"_inputError_j8a1u_175",errorMessage:"_errorMessage_j8a1u_180",content:"_content_j8a1u_190",footer:"_footer_j8a1u_233"};let L=0;function M({title:n,onClose:r,children:o,footer:a,headerButtons:i,className:c="",overlayStyle:l,...u}){t.useEffect((()=>(1==++L&&document.body.classList.add("modal-open"),()=>{0==--L&&document.body.classList.remove("modal-open")})),[]);const d=e.jsx("div",{className:N.overlay,style:l,onClick:r,children:e.jsxs("div",{className:`${N.modal} ${c}`,onClick:e=>e.stopPropagation(),...u,children:[n&&e.jsxs("div",{className:N.header,children:[e.jsx("h2",{children:n}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[i,e.jsx("button",{className:N.closeButton,onClick:r,"aria-label":"Close",type:"button","data-gamepad-focusable":"true",children:"×"})]})]}),e.jsx("div",{className:N.content,children:o}),a&&e.jsx("div",{className:N.footer,children:a})]})});return s.createPortal(d,document.body)}const D="_keyboardModal_7mp5j_2",U="_inputDisplay_7mp5j_7",O="_tempInput_7mp5j_13",B="_keyboardGrid_7mp5j_31",z="_keyRow_7mp5j_35",q="_key_7mp5j_2",G="_specialKey_7mp5j_77",F="_spaceKey_7mp5j_86",R="_activeShift_7mp5j_91",V=({isVisible:n,onClose:r,onEnter:s,inputType:o="text",initialValue:a=""})=>{const{keyboardTitle:i}=J(),[c,l]=t.useState("lowercase"),[u,d]=t.useState("");t.useEffect((()=>{d(n?"number"===o?a&&"0"!==a?a:"":a||"":"")}),[n,a,o]);const p={lowercase:[["1","2","3","4","5","6","7","8","9","0"],["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["shift","z","x","c","v","b","n","m","backspace"],["space","enter"]],uppercase:[["1","2","3","4","5","6","7","8","9","0"],["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["shift","Z","X","C","V","B","N","M","backspace"],["space","enter"]],numbers:[["1","2","3"],["4","5","6"],["7","8","9"],["0","backspace"],["enter"]]}["number"===o?"numbers":c],h=t.useCallback((e=>{switch(e){case"shift":l((e=>"lowercase"===e?"uppercase":"lowercase"));break;case"backspace":d((e=>e.slice(0,-1)));break;case"enter":s?.(u);break;case"space":d((e=>e+" "));break;default:d((t=>t+e))}}),[s,u]),m=e=>{switch(e){case"shift":return"⇧";case"backspace":return"⌫";case"space":return"Space";case"enter":return"↵";default:return e}},f=e=>{let t=q;return["shift","backspace","space","enter"].includes(e)&&(t+=` ${G}`),"space"===e&&(t+=` ${F}`),"shift"===e&&"uppercase"===c&&(t+=` ${R}`),t};return t.useEffect((()=>{if(n){const e=e=>{"Escape"===e.key&&(e.preventDefault(),r?.())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}}),[n,r]),n?e.jsxs(M,{title:i||("number"===o?"Number Pad":"Virtual Keyboard"),onClose:r,className:D,overlayStyle:{zIndex:1300},children:[e.jsx("div",{className:U,children:e.jsx("input",{type:"password"===o?"password":"text",value:u,className:O,readOnly:!0,placeholder:"Type below..."})}),e.jsx("div",{className:B,children:p.map(((t,n)=>e.jsx("div",{className:z,children:t.map(((t,r)=>e.jsx("button",{className:f(t),onClick:()=>h(t),"data-gamepad-focusable":"true","aria-label":"backspace"===t?"Backspace":"enter"===t?"Enter":"space"===t?"Space":"shift"===t?"Shift":t,children:m(t)},`${n}-${r}`)))},n)))})]}):null},K=t.createContext(),J=()=>{const e=t.useContext(K);if(!e)throw new Error("useVirtualKeyboardContext must be used within a VirtualKeyboardProvider");return e},W=({children:n})=>{const r=(()=>{const[e,n]=t.useState(!1),[r,s]=t.useState(null),[o,a]=t.useState("text"),[i,c]=t.useState(""),[l,u]=t.useState(!1);t.useEffect((()=>{const e=()=>{const e=document.body.classList.contains("gamepad-navigation-active");u(e)};e();const t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>t.disconnect()}),[]);const d=t.useCallback(((e,t="text",r="")=>{e&&(s(e),a(t),c(r),n(!0),e.blur())}),[]),p=t.useCallback((()=>{n(!1),s(null),a("text"),c("")}),[]),h=t.useCallback((e=>{if(!r)return;Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(r,e||"");const t=new Event("input",{bubbles:!0});r.dispatchEvent(t);const n=new Event("change",{bubbles:!0});r.dispatchEvent(n),p()}),[r,p]),m=t.useCallback(((e,t="text",n="")=>{if(!e)return;let r=e;e.querySelector&&e.querySelector("input")&&(r=e.querySelector("input"));const s=e=>{l&&document.body.classList.contains("gamepad-navigation-active")&&(e.preventDefault(),d(r,t,n))};return r.addEventListener("click",s),()=>{r.removeEventListener("click",s)}}),[l,d]),f=t.useCallback((()=>r?.value||""),[r]);return{isVisible:e,inputType:o,keyboardTitle:i,currentInput:r,isGamepadActive:l,showKeyboard:d,hideKeyboard:p,handleEnter:h,enhanceInput:m,getCurrentInputValue:f}})(),{isVisible:s,inputType:o,hideKeyboard:a,handleEnter:i,getCurrentInputValue:c}=r;return e.jsxs(K.Provider,{value:r,children:[n,s&&e.jsx(V,{isVisible:s,inputType:o,initialValue:c(),onClose:a,onEnter:i})]})},H="_toast_1yqi6_1",Q="_slideOut_1yqi6_31",Z="_iconWrapper_1yqi6_46",X="_icon_1yqi6_46",Y="_emojiIcon_1yqi6_61",ee="_content_1yqi6_75",te="_title_1yqi6_82",ne="_message_1yqi6_89",re="_emojiMessage_1yqi6_97",se="_playerName_1yqi6_104",oe="_reactionText_1yqi6_110",ae="_emojiReaction_1yqi6_116",ie="_closeButton_1yqi6_134",ce=({title:n,message:r,emoji:s="ℹ",color:o="#3498db",duration:a=4e3,onClose:i,position:c})=>{const[l,u]=t.useState(!0);t.useEffect((()=>{if(a>0){const e=setTimeout((()=>{u(!1),setTimeout(i,300)}),a);return()=>clearTimeout(e)}}),[a,i]);const d=!n&&"ℹ"!==s;return e.jsxs("div",{className:`${H} ${d&&l?ae:""} ${l?"":Q}`,style:{top:"20px",zIndex:1e4+c,borderColor:o,background:"linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)"},children:[e.jsx("div",{className:Z,children:e.jsx("span",{className:`${X} ${d?Y:""}`,style:{color:o,textShadow:d?`0 0 20px ${o}, 0 0 40px ${o}60`:`0 0 8px ${o}80`},children:s})}),e.jsxs("div",{className:ee,children:[n&&e.jsx("div",{className:te,children:n}),e.jsx("div",{className:`${ne} ${d?re:""}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:se,children:r}),e.jsx("span",{className:oe,children:"reacted!"})]}):r})]}),e.jsx("button",{className:ie,onClick:i,"aria-label":"Close notification",children:"×"})]})},le=t.createContext(),ue=({children:n})=>{const[r,s]=t.useState([]),[o,a]=t.useState([]),[i,c]=t.useState(0),{socket:l}=w(),u=t.useCallback(((e,t,n="ℹ",r="#3498db",o=4e3)=>{const l=Date.now()+Math.random(),u={id:l,title:e,message:t,emoji:n,color:r,duration:o},d=Date.now();return d-i>=600?(s((e=>[...e,u])),c(d)):a((e=>[...e,u])),l}),[i]),d=t.useCallback((e=>{s((t=>t.filter((t=>t.id!==e))))}),[]),p=t.useCallback(((e,t,n)=>u(e,t,"✓","#27ae60",n)),[u]),h=t.useCallback(((e,t,n)=>u(e,t,"✕","#e74c3c",n)),[u]),m=t.useCallback(((e,t,n)=>u(e,t,"⚠","#f39c12",n)),[u]),f=t.useCallback(((e,t,n)=>u(e,t,"ℹ","#3498db",n)),[u]),b=t.useCallback(((e,t,n)=>u(e,t,"🎮","#9b59b6",n)),[u]),y=t.useCallback(((e,t,n)=>u(e,t,"💰","#16a085",n)),[u]);t.useEffect((()=>{if(0===o.length)return;const e=setTimeout((()=>{const e=o[0];a((e=>e.slice(1))),s((t=>[...t,e])),c(Date.now())}),600);return()=>clearTimeout(e)}),[o,r]),t.useEffect((()=>{if(!l)return;const e=e=>{u(e.title||"",e.message,e.emoji||"ℹ",e.color||"#3498db",e.duration)};return l.on("toast",e),()=>{l.off("toast",e)}}),[l,u]);const A={addToast:u,removeToast:d,showSuccess:p,showError:h,showWarning:m,showInfo:f,showGameEvent:b,showMoneyEvent:y,toasts:r};return e.jsxs(le.Provider,{value:A,children:[n,e.jsx("div",{className:"toast-container",style:{position:"fixed",top:0,right:0,zIndex:1e4},children:r.map(((t,n)=>e.jsx(ce,{title:t.title,message:t.message,emoji:t.emoji,color:t.color,duration:t.duration,position:n,onClose:()=>d(t.id)},t.id)))})]})};function de(){return t.useEffect((()=>{u.initialize()}),[]),e.jsx(ue,{children:e.jsx(W,{children:e.jsx(o,{router:$})})})}const pe=t.createContext(null),he=e=>{if(!e)return null;const t="https://api.in-between.live";if(e.startsWith("http"))return e;if(e.startsWith("/files/"))return`${t}${e}`;if(e.includes("/uploads/")){const n=e.split("/"),r=n.pop();return`${t}/files/${n[n.length-1]}/${r}`}return`${t}${e}`},me=e=>e?{...e,profileImg:he(e.profileImg),twoSecondPotGif:he(e.twoSecondPotGif),twoSecondPotMp3:e.twoSecondPotMp3}:{},fe=({children:n})=>{const[r,s]=t.useState({profileImg:null,autoAnte:!1,muted:!1,twoSecondPotGif:null,twoSecondPotMp3:null,selectedTitle:null}),[o,i]=t.useState(!0),{user:c}=k(),l=a.useCallback((async()=>{if(!c)return s({autoAnte:!1}),void i(!1);try{i(!0);const e="https://api.in-between.live",t=localStorage.getItem("token");if(!t)return void i(!1);const n=await fetch(`${e}/preferences`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Failed to load preferences");const r=await n.json(),o=me(r)||{autoAnte:!1,muted:!1};s(o),void 0!==o.muted&&u.setMuted(o.muted)}catch(e){s({autoAnte:!1})}finally{i(!1)}}),[c]);t.useEffect((()=>{c&&l()}),[c,l]);const d=async(e,t)=>{if(!c)return!1;try{const n="https://api.in-between.live",r=localStorage.getItem("token");if(!r)return!1;s((n=>({...n,[e]:t}))),"muted"===e&&u.setMuted(t);const o=await fetch(`${n}/preferences/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({value:t})});if(!o.ok)throw new Error(`Failed to update ${e} preference`);const a=await o.json(),i=me(a);return s(i),!0}catch(n){return await l(),!1}};return e.jsx(pe.Provider,{value:{preferences:r,updatePreference:d,toggleAutoAnte:async()=>{const e=!r.autoAnte;return await d("autoAnte",e)},toggleMute:async()=>{const e=!r.muted;return await d("muted",e)},updateSelectedTitle:async e=>await d("selectedTitle",e),uploadTwoSecondPotGif:async e=>{if(!e)return!1;try{const t=new FormData;t.append("file",e);const n="https://api.in-between.live",r=localStorage.getItem("token");if(!r)return!1;const o=await fetch(`${n}/preferences/twoSecondPotGif`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t}),a=await o.text();if(!o.ok)throw new Error(`Failed to upload GIF file: ${a}`);const i=a?JSON.parse(a):{},c=he(i.fileUrl);return s((e=>({...e,twoSecondPotGif:c}))),!0}catch(t){return!1}},uploadTwoSecondPotMp3:async e=>{if(!e)return!1;try{const t=new FormData;t.append("file",e);const n="https://api.in-between.live",r=localStorage.getItem("token");if(!r)return!1;const o=await fetch(`${n}/preferences/twoSecondPotMp3`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t}),a=await o.text();if(!o.ok)throw new Error(`Failed to upload MP3 file: ${a}`);const i=a?JSON.parse(a):{};return s((e=>({...e,twoSecondPotMp3:i.fileUrl}))),!0}catch(t){return!1}},uploadProfileImg:async e=>{if(!e)return!1;try{const t=new FormData;t.append("file",e);const n="https://api.in-between.live",r=localStorage.getItem("token");if(!r)return!1;const o=await fetch(`${n}/preferences/profileImg`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t}),a=await o.text();if(!o.ok)throw new Error(`Failed to upload profile image: ${a}`);const i=a?JSON.parse(a):{},c=he(i.fileUrl);return s((e=>({...e,profileImg:c}))),!0}catch(t){return!1}},loading:o},children:n})},be=()=>{const e=t.useContext(pe);if(!e)throw new Error("usePreferences must be used within a PreferencesProvider");return e},ye=t.createContext(null),Ae=({children:n})=>{const{socket:r}=w(),{token:s}=k(),[o,a]=t.useState(new Map),i=t.useRef(new Set),c=t.useRef(null);t.useEffect((()=>{if(!r)return;const e=({userId:e,data:t})=>{a((n=>{const r=new Map(n);return r.set(e,t),r}))};return r.on("userDataUpdated",e),()=>{r.off("userDataUpdated",e)}}),[r]),t.useEffect((()=>()=>{c.current&&clearTimeout(c.current)}),[]);const l=t.useCallback((async e=>{if(!e||0===e.length||!s)return{};try{const t=await fetch(`${A}/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({userIds:e})});if(!t.ok)throw new Error("Failed to fetch users data");const n=await t.json();return a((e=>{const t=new Map(e);return Object.entries(n).forEach((([e,n])=>{t.set(e,n)})),t})),n}catch(t){return{}}}),[s]),u=t.useCallback((()=>{if(0===i.current.size)return;const e=Array.from(i.current);i.current.clear(),l(e)}),[l]),d={getUserData:t.useCallback((e=>{if(!e)return null;const t=o.get(e);return t||(i.current.add(e),c.current&&clearTimeout(c.current),c.current=setTimeout((()=>{u()}),10),null)}),[o,u]),prefetchUsers:t.useCallback((e=>{const t=e.filter((e=>!o.has(e)));t.length>0&&l(t)}),[o,l])};return e.jsx(ye.Provider,{value:d,children:n})},_e=e=>{const n=t.useContext(ye);if(!n)throw new Error("useUserData must be used within UserDataProvider");return n.getUserData(e)};i.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(j,{children:e.jsx(g,{children:e.jsx(Ae,{children:e.jsx(fe,{children:e.jsx(de,{})})})})})}));export{A,M as B,y as L,ye as U,w as a,_e as b,N as c,S as d,J as e,be as f,u as s,k as u};
