import{a3 as $,U as e,a4 as T,a2 as D,a5 as U,a6 as W,a7 as H}from"./index-_xfNKmhx.js";import{r as f,u as q}from"./vendor-x77BqUlH.js";import{u as R}from"./useGamepadNavigation-C3EA71Rv.js";import{A as F}from"./AppHeader-BH5KBjjg.js";import{C as J,U as Q,R as V,P as Y,S as X,a as Z,b as K,T as w,G as I}from"./GamepadInput-CGO8_Os4.js";import{g as ee}from"./version-DUDEi3OG.js";import"./audio-DijUiIHu.js";import"./socket-CA1CrNgP.js";const se="_lobbyScreen_zr70y_1",te="_versionInfo_zr70y_6",ae="_legalLinks_zr70y_16",ne="_legalLink_zr70y_16",re="_legalDivider_zr70y_35",oe="_gameListTitle_zr70y_69",ie="_searchContainer_zr70y_82",le="_gameListWrapper_zr70y_119",ce="_userDisconnectedGame_zr70y_138",me="_userInGame_zr70y_145",de="_gameListInfo_zr70y_168",ue="_gameListId_zr70y_173",pe="_disconnectedBadge_zr70y_182",he="_inGameBadge_zr70y_194",ge="_gameListPlayers_zr70y_206",xe="_emptyStateIcon_zr70y_273",fe="_emptyStateMessage_zr70y_279",_e="_emptyStateHint_zr70y_286",Ne="_privatePill_zr70y_292",je="_gameActionsSection_zr70y_305",ve="_gameCard_zr70y_312",m={lobbyScreen:se,versionInfo:te,legalLinks:ae,legalLink:ne,legalDivider:re,gameListTitle:oe,searchContainer:ie,gameListWrapper:le,userDisconnectedGame:ce,userInGame:me,gameListInfo:de,gameListId:ue,disconnectedBadge:pe,inGameBadge:he,gameListPlayers:ge,emptyStateIcon:xe,emptyStateMessage:fe,emptyStateHint:_e,privatePill:Ne,gameActionsSection:je,gameCard:ve},ye="_pill_q09di_1",be="_pulse_q09di_23",Ce="_text_q09di_49",B={pill:ye,pulse:be,text:Ce},Se=()=>{const{socket:n,isConnected:i}=$(),[o,t]=f.useState(null);return f.useEffect(()=>{if(!n||!i)return;n.emit("getOnlinePlayerCount",a=>{t(a)});const g=a=>t(a);return n.on("onlinePlayerCountUpdate",g),()=>{n.off("onlinePlayerCountUpdate",g)}},[n,i]),o===null?null:e.jsxs("div",{className:B.pill,children:[e.jsx("span",{className:B.pulse}),e.jsxs("span",{className:B.text,children:[o," online"]})]})},Ie="_balanceSection_1ap8t_1",we="_balanceLabel_1ap8t_10",Le="_xpSection_1ap8t_17",Be="_xpBarContainer_1ap8t_21",Ae="_xpOverlay_1ap8t_31",Ge="_xpLevel_1ap8t_45",Pe="_xpNext_1ap8t_52",ke="_xpBar_1ap8t_21",v={balanceSection:Ie,balanceLabel:we,xpSection:Le,xpBarContainer:Be,xpOverlay:Ae,xpLevel:Ge,xpNext:Pe,xpBar:ke},ze=({userId:n,balance:i})=>{const o=T(n);return e.jsxs("div",{className:"panel-alt",style:{width:"100%",flex:2},children:[e.jsxs("div",{className:v.balanceSection,children:[e.jsx("span",{className:v.balanceLabel,children:"Balance:"}),e.jsx(J,{amount:Number(i)||0,size:"medium"})]}),o&&e.jsx("div",{className:v.xpSection,children:e.jsxs("div",{className:v.xpBarContainer,children:[e.jsx("div",{className:v.xpBar,style:{width:o.level>=100?"100%":`${o.percentToNextLevel||0}%`}}),e.jsxs("div",{className:v.xpOverlay,children:[e.jsxs("div",{className:v.xpLevel,children:["Level ",o.level]}),e.jsx("div",{className:v.xpNext,children:o.level<100?`${o.xpToNextLevel.toLocaleString()} XP`:"MAX"})]})]})})]})},$e="_userSection_53k67_2",De="_avatarContainer_53k67_12",Ee="_headerButtons_53k67_16",Oe="_logoutButton_53k67_40",S={userSection:$e,avatarContainer:De,headerButtons:Ee,logoutButton:Oe},Me=()=>{const{user:n,logout:i,refreshUserData:o}=D(),[t,g]=f.useState(!1);return e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{className:`panel ${S.userSection}`,children:[e.jsx("div",{className:S.avatarContainer,children:e.jsx(Q,{userId:n?.id,size:"medium",showName:!0,namePosition:"right"})}),e.jsx(ze,{userId:n?.id,balance:n?.balance}),e.jsxs("div",{className:S.headerButtons,children:[e.jsx("button",{className:S.logoutButton,onClick:i,"data-gamepad-focusable":"true",children:e.jsx("span",{className:S.buttonText,children:"Logout"})}),e.jsx(V,{"data-gamepad-focusable":"true"}),e.jsx(Y,{"data-gamepad-focusable":"true"}),e.jsx(X,{onClick:()=>g(!0),"data-gamepad-focusable":"true"}),e.jsx(Z,{"data-gamepad-focusable":"true"})]})]}),t&&e.jsx(K,{onClose:()=>{g(!1),o&&o()}})]})},Te=({className:n="",width:i="1em",height:o="1em",...t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`feather feather-lock ${n}`,width:i,height:o,...t,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]});function Ue({game:n,onJoin:i,userId:o}){const t=n.settings?.customName||`Game ${n.id}`,g=n.disconnectedPlayers?.some(h=>h.userId===o),a=n.allPlayers?.some(h=>h.userId===o&&!h.disconnected);let d="Join";g?d="Reconnect":a&&(d="Continue");let y=`panel ${m.gameCard}`;return g?y+=` ${m.userDisconnectedGame}`:a&&(y+=` ${m.userInGame}`),e.jsxs("div",{className:y,children:[" ",e.jsxs("div",{className:m.gameListInfo,style:{flex:1},children:[e.jsxs("div",{className:m.gameListId,children:[" ",t,n.settings?.isPrivate&&e.jsxs("span",{className:m.privatePill,title:"Private Game",children:[e.jsx(Te,{width:"0.9em",height:"0.9em",style:{marginRight:"4px",verticalAlign:"middle"}}),"Private"]}),g&&e.jsx("span",{className:m.disconnectedBadge,title:"You're disconnected from this game",children:"âš ï¸ Reconnect"}),a&&e.jsx("span",{className:m.inGameBadge,title:"You're in this game",children:"You're In"})]}),e.jsxs("div",{className:m.gameListPlayers,children:[" ",n.playerCount," ",n.playerCount===1?"player":"players"]})]}),e.jsx("button",{className:"btn btn-primary",style:{padding:"0.4rem 1rem",fontSize:"0.9rem",minWidth:"80px",maxWidth:"100px",flexShrink:0},onClick:()=>i(n.id),disabled:!o,"data-gamepad-focusable":"true",children:d})]})}const We="_gameSettingItem_tzwbj_1",He="_settingDescription_tzwbj_13",qe="_settingControls_tzwbj_35",Re="_textInput_tzwbj_42",Fe="_inputError_tzwbj_60",r={gameSettingItem:We,settingDescription:He,settingControls:qe,textInput:Re,inputError:Fe},z={useCustomName:!1,customName:"",isPrivate:!1,password:"",enableAceChoice:!0,enableSecondChance:!0,numberOfBots:0,anteAmount:""},Je=({initialSettings:n=z,onSubmit:i,onClose:o})=>{const[t,g]=f.useState({...z,...n}),[a,d]=f.useState({}),y=s=>{const p={};if(s.useCustomName){const u=s.customName||"";u?u.length<4||u.length>26?p.customName="Name must be 4-26 characters.":/^[a-zA-Z0-9_-]+$/.test(u)||(p.customName="Use letters, numbers, -, or _."):p.customName="Custom name is required."}if(s.isPrivate){const u=s.password||"";u?(u.length<3||u.length>36)&&(p.password="Password must be 3-36 characters."):p.password="Password is required."}const l=s.numberOfBots;(l<0||l>16)&&(p.numberOfBots="Number of bots must be between 0 and 16.");const c=s.anteAmount;if(c!==""&&c!==null&&c!==void 0){const u=parseInt(c);(isNaN(u)||u<1||u>100)&&(p.anteAmount="Ante amount must be between 1 and 100.")}return p},h=(s,p)=>{g(l=>{const c={...l,[s]:p};return s==="useCustomName"&&!p&&(c.customName="",a.customName&&d(u=>{const _={...u};return delete _.customName,_})),s==="isPrivate"&&!p&&(c.password="",a.password&&d(u=>{const _={...u};return delete _.password,_})),c}),(s==="customName"||s==="useCustomName")&&a.customName&&d(l=>{const c={...l};return delete c.customName,c}),(s==="password"||s==="isPrivate")&&a.password&&d(l=>{const c={...l};return delete c.password,c}),s==="numberOfBots"&&a.numberOfBots&&d(l=>{const c={...l};return delete c.numberOfBots,c}),s==="anteAmount"&&a.anteAmount&&d(l=>{const c={...l};return delete c.anteAmount,c})},C=s=>{s.preventDefault();const p=y(t);if(Object.keys(p).length>0)d(p);else{d({});const l={...t,customName:t.useCustomName?t.customName:null,anteAmount:t.anteAmount===""?1:parseInt(t.anteAmount)};delete l.useCustomName,i(l)}};return e.jsx(U,{title:"Game Options",onClose:o,style:{maxWidth:600},footer:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",onClick:o,className:"btn btn-secondary","data-gamepad-focusable":"true",children:"Cancel"}),e.jsx("button",{type:"submit",form:"gameSettingsForm",className:"btn btn-primary",disabled:Object.keys(a).length>0,"data-gamepad-focusable":"true",children:"Create Game"})]}),children:e.jsxs("form",{id:"gameSettingsForm",onSubmit:C,children:[e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Custom Game Name"}),e.jsx("p",{children:"Set a custom name for your game lobby"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(w,{isChecked:t.useCustomName,onChange:s=>h("useCustomName",s.target.checked)}),t.useCustomName&&e.jsx(I,{title:"Enter Game Name",type:"text",value:t.customName||"",onChange:s=>h("customName",s.target.value),className:`${r.textInput}${a.customName?" "+r.inputError:""}`,placeholder:"Game Name",maxLength:26,style:{marginTop:8}}),a.customName&&e.jsx("span",{className:"errorMessage",children:a.customName})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Private Game"}),e.jsx("p",{children:"Only players with the password can join"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(w,{isChecked:t.isPrivate,onChange:s=>h("isPrivate",s.target.checked)}),t.isPrivate&&e.jsx(I,{title:"Enter Game Password",type:"text",value:t.password||"",onChange:s=>h("password",s.target.value),className:`${r.textInput}${a.password?" "+r.inputError:""}`,placeholder:"Password",maxLength:36,style:{marginTop:8}}),a.password&&e.jsx("span",{className:"errorMessage",children:a.password})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Number of Bots"}),e.jsx("p",{children:"Add AI players to your game (0-16)"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(I,{title:"Number of AI Players",type:"number",min:"0",max:"16",value:t.numberOfBots===0?"":t.numberOfBots,onChange:s=>h("numberOfBots",s.target.value===""?0:parseInt(s.target.value)||0),className:`${r.textInput} no-validation${a.numberOfBots?" "+r.inputError:""}`,placeholder:"0"}),a.numberOfBots&&e.jsx("span",{className:"errorMessage",children:a.numberOfBots})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Ante Amount"}),e.jsx("p",{children:"Set the ante amount for each round (1-100)"})]}),e.jsxs("div",{className:r.settingControls,children:[e.jsx(I,{title:"Ante Amount",type:"number",min:"1",max:"100",value:t.anteAmount,onChange:s=>h("anteAmount",s.target.value),className:`${r.textInput} no-validation${a.anteAmount?" "+r.inputError:""}`,placeholder:"1"}),a.anteAmount&&e.jsx("span",{className:"errorMessage",children:a.anteAmount})]})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Enable Ace Choice"}),e.jsx("p",{children:"Allow players to choose high/low on Ace"})]}),e.jsx("div",{className:r.settingControls,children:e.jsx(w,{isChecked:t.enableAceChoice,onChange:s=>h("enableAceChoice",s.target.checked)})})]}),e.jsxs("div",{className:`panel-alt ${r.gameSettingItem}`,children:[e.jsxs("div",{className:r.settingDescription,children:[e.jsx("h4",{children:"Enable Second Chance"}),e.jsx("p",{children:"Allow players to ante up for a second chance"})]}),e.jsx("div",{className:r.settingControls,children:e.jsx(w,{isChecked:t.enableSecondChance,onChange:s=>h("enableSecondChance",s.target.checked)})})]})]})})},ts=()=>{const{gameList:n}=W(),{user:i,logout:o}=D(),{socket:t,isConnected:g}=$();R(!0);const a=q(),[d,y]=f.useState(""),[h,C]=f.useState(!1),[s,p]=f.useState(null),l=i?.id||null;f.useEffect(()=>{ee().then(p)},[]),f.useEffect(()=>{if(i&&(!i.username||!i.id)){console.error("[Lobby] Invalid user data received:",i),o();return}},[i,o]);const c=x=>{!g||!i||(H.play("ui.click"),a(`/${x}`))},u=x=>{y(x.target.value)},_=x=>{if(!i?.id||!g)return;const N=j=>{t.off("gameCreated",N),j?.game?.id&&a(`/${j.game.id}`)};t.on("gameCreated",N),x?t.emit("createGame",{settings:x}):t.emit("createGame")},E=()=>_({numberOfBots:5}),O=()=>{C(!0)},M=x=>{C(!1),_(x)},L=f.useMemo(()=>{if(!n)return[];let x=n;if(d.trim()){const N=d.trim().toLowerCase();x=n.filter(j=>j.id.toLowerCase().includes(N))}return x.sort((N,j)=>{const A=N.allPlayers?.some(b=>b.userId===l),G=j.allPlayers?.some(b=>b.userId===l),P=N.disconnectedPlayers?.some(b=>b.userId===l),k=j.disconnectedPlayers?.some(b=>b.userId===l);return P&&!k?-1:!P&&k?1:A&&!G?-1:!A&&G?1:N.id.localeCompare(j.id)})},[n,d,l]);return e.jsxs("div",{className:`screen app-gradient-bg ${m.lobbyScreen}`,children:[e.jsx(F,{}),e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"1.1em",marginBottom:"-0.6em"},children:e.jsx(Se,{})}),e.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"600px",marginBottom:"2rem"},children:[e.jsx(Me,{}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:m.gameActionsSection,children:[e.jsx("button",{className:"btn btn-primary",onClick:E,disabled:!i?.username,"data-gamepad-focusable":"true",children:"Create Quick Game"}),e.jsx("button",{className:"btn btn-primary",onClick:O,disabled:!i?.username,"data-gamepad-focusable":"true",children:"Create Custom Game"})]})]}),e.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"600px",minHeight:"200px"},children:[e.jsx("h2",{className:m.gameListTitle,children:"Available Games"}),e.jsx("div",{className:m.searchContainer,children:e.jsxs("div",{className:"input-with-icon",children:[e.jsx("span",{className:"input-icon left",children:"ðŸ”"}),e.jsx(I,{title:"Search Games",type:"search",className:"no-validation",placeholder:"Search games by ID",value:d,onChange:u})]})}),L&&L.length>0?e.jsx("div",{className:m.gameListWrapper,children:L.map(x=>e.jsx(Ue,{game:x,onJoin:c,userId:l},x.id))}):e.jsxs("div",{className:"panel-alt",style:{textAlign:"center",padding:"2rem",minHeight:"150px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{className:m.emptyStateIcon,children:"ðŸƒ"}),e.jsx("p",{className:m.emptyStateMessage,children:d.trim()?"No matching games found":"No games in progress"}),e.jsx("p",{className:m.emptyStateHint,children:d.trim()?"Try a different search or create a new game":"Create a new game to get started!"})]})]}),h&&e.jsx(Je,{onSubmit:M,onClose:()=>C(!1)}),s&&e.jsxs("div",{className:m.versionInfo,children:[e.jsxs("div",{className:m.legalLinks,children:[e.jsx("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",className:m.legalLink,children:"Terms of Service"}),e.jsx("span",{className:m.legalDivider,children:"â€¢"}),e.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",className:m.legalLink,children:"Privacy Policy"})]}),e.jsx("div",{children:s.display})]})]})};export{ts as default};
