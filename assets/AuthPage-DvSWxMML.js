import{u as v,j as r,a as j,A as w}from"./index-BWrYPZTB.js";import{b as s,u as y}from"./vendor-ByZL_ylL.js";import{u as C}from"./useGamepadNavigation-DCsD-Nlu.js";import{A as _}from"./AppHeader-DDYGVuDk.js";import"./audio-Do0jXn0P.js";import"./socket-CA1CrNgP.js";const b="_authForm_1wx71_1",A="_errorAlert_1wx71_95",x={authForm:b,errorAlert:A},N=({onSubmit:a,mode:i})=>{const[g,f]=s.useState(""),[u,c]=s.useState(""),[h,d]=s.useState(""),n=s.useRef(null),l=s.useRef(null),{enhanceInput:o}=v();s.useEffect(()=>{let e,t;return n.current&&(e=o(n.current,"text","Enter Username")),l.current&&(t=o(l.current,"password","Enter Password")),()=>{e&&e(),t&&t()}},[o]);const p=async e=>{e.preventDefault(),d("");try{await a(g,u)}catch(t){d(t.message)}};return r.jsxs("div",{className:`card ${x.authForm}`,children:[r.jsx("h2",{style:{color:"var(--text-primary)",fontWeight:600,textAlign:"center",marginTop:0},children:i==="login"?"Welcome Back":"Create Account"}),r.jsx("div",{className:"divider",style:{marginBottom:"1.5rem"}}),h&&r.jsx("div",{className:x.errorAlert,children:h}),r.jsxs("form",{onSubmit:p,children:[r.jsxs("div",{className:"input-group",children:[r.jsx("label",{htmlFor:"username",className:"input-label required",children:"Username"}),r.jsx("input",{ref:n,id:"username",type:"text",className:"no-validation",placeholder:"Enter your username",value:g,onChange:e=>f(e.target.value),required:!0,minLength:3,"data-gamepad-focusable":"true",autoCapitalize:"none",autoCorrect:"off",autoComplete:"username"})]}),r.jsxs("div",{className:"input-group",children:[r.jsx("label",{htmlFor:"password",className:"input-label required",children:"Password"}),r.jsx("input",{ref:l,id:"password",type:"password",className:"no-validation",placeholder:"Enter your password",value:u,onChange:e=>c(e.target.value),required:!0,minLength:6,"data-gamepad-focusable":"true",autoComplete:i==="login"?"current-password":"new-password"})]}),r.jsx("button",{type:"submit",className:"btn btn-primary","data-gamepad-focusable":"true",children:i==="login"?"Sign In":"Create Account"})]})]})},E="_authPage_jks4l_1",k="_error_jks4l_9",P="_formContainer_jks4l_22",S="_toggleContainer_jks4l_88",F="_toggleButton_jks4l_93",m={authPage:E,error:k,formContainer:P,toggleContainer:S,toggleButton:F},L=()=>{const[a,i]=s.useState("login"),{login:g}=j(),f=y();C(!0);const[u,c]=s.useState(null),h=async(d,n)=>{if(!d||!n){c("Username and password are required");return}c(null);const l=`${w}/auth/${a}`;try{const p=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:d,password:n})});let e;try{e=await p.json()}catch(t){throw console.error("[Client] Error parsing response:",t),new Error("Invalid response from server")}if(!p.ok)throw new Error(e.message||"Authentication failed");if(!e.user?.username||!e.user?.id||!e.token)throw console.error("[Client] Invalid response format:",{hasUser:!!e.user,hasUsername:!!e.user?.username,hasId:!!e.user?.id,hasToken:!!e.token}),new Error("Invalid server response format");try{g(e.user,e.token),f("/")}catch(t){throw console.error("[Client] Error in login callback:",t),new Error("Failed to initialize user session")}}catch(o){console.error("[Client] Auth error:",{message:o.message,endpoint:l,mode:a}),c(o.message||"Failed to connect to server")}};return r.jsxs("div",{className:`screen ${m.authPage}`,children:[r.jsx(_,{}),r.jsxs("div",{className:m.formContainer,children:[u&&r.jsx("div",{className:m.error,children:u}),r.jsx(N,{mode:a,onSubmit:h}),r.jsx("div",{className:m.toggleContainer,children:r.jsx("button",{className:m.toggleButton,onClick:()=>i(a==="login"?"register":"login"),"data-gamepad-focusable":"true",children:a==="login"?"Don't have an account? Register":"Already have an account? Login"})})]})]})};export{L as default};
