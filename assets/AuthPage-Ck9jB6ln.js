import{u as e,j as r,P as o,T as a,A as t,B as n,a as i}from"./ui-DgYMOojV.js";import{r as s,u as l}from"./vendor-BoU4GIkp.js";import{G as u,A as d}from"./AppHeader-CtqZxnNA.js";import{u as c,A as m}from"./index-pHr3zac6.js";import{u as g}from"./useGamepadNavigation-Kc11nJyB.js";const f="_authForm_121ec_1",p="_submitButton_121ec_99",h=({onSubmit:i,mode:l})=>{const[d,c]=s.useState(""),[m,g]=s.useState(""),[h,v]=s.useState("");e("(max-width:600px)");const x=e("(max-width:400px)");return r.jsxs(o,{className:f,elevation:0,children:[r.jsx(a,{variant:"h5",component:"h2",gutterBottom:!0,sx:{color:"var(--info)",fontWeight:600},children:"login"===l?"Welcome Back":"Create Account"}),h&&r.jsx(t,{severity:"error",sx:{mb:2,backgroundColor:"rgba(231, 76, 60, 0.2)",color:"var(--text-primary)"},children:h}),r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),v("");try{await i(d,m)}catch(r){v(r.message)}},children:[r.jsx(u,{title:"Enter Username",label:"Username",variant:"outlined",fullWidth:!0,margin:"normal",value:d,onChange:e=>c(e.target.value),required:!0,size:x?"small":"medium",inputProps:{minLength:3},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"var(--info-light)"},"&:hover fieldset":{borderColor:"var(--info)"},"&.Mui-focused fieldset":{borderColor:"var(--info)"},backgroundColor:"rgba(255, 255, 255, 0.1)"},"& .MuiInputLabel-root":{color:"var(--info-light)",fontSize:x?"0.9rem":"1rem"},"& .MuiOutlinedInput-input":{color:"var(--text-dark)",fontWeight:500,backgroundColor:"rgba(255, 255, 255, 0.85)",padding:x?"12px 14px":"16.5px 14px"},"& .MuiInputLabel-root.Mui-focused":{color:"var(--info)"},marginBottom:x?"0.5rem":"1rem"}}),r.jsx(u,{title:"Enter Password",label:"Password",type:"password",variant:"outlined",fullWidth:!0,margin:"normal",value:m,onChange:e=>g(e.target.value),required:!0,size:x?"small":"medium",inputProps:{minLength:6},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"var(--info-light)"},"&:hover fieldset":{borderColor:"var(--info)"},"&.Mui-focused fieldset":{borderColor:"var(--info)"},backgroundColor:"rgba(255, 255, 255, 0.1)"},"& .MuiInputLabel-root":{color:"var(--info-light)",fontSize:x?"0.9rem":"1rem"},"& .MuiOutlinedInput-input":{color:"var(--text-dark)",fontWeight:500,backgroundColor:"rgba(255, 255, 255, 0.85)",padding:x?"12px 14px":"16.5px 14px"},"& .MuiInputLabel-root.Mui-focused":{color:"var(--info)"},marginBottom:x?"0.5rem":"1rem"}}),r.jsx(n,{type:"submit",variant:"contained",fullWidth:!0,size:"large",className:p,"data-gamepad-focusable":"true",sx:{mt:x?2:3,background:"linear-gradient(to right, var(--info), var(--success))",textTransform:"none",fontWeight:"bold",letterSpacing:"0.5px",padding:x?"10px":"12px",fontSize:x?"0.9rem":"1rem","&:hover":{background:"linear-gradient(to right, var(--info-dark), var(--success-dark))",boxShadow:"var(--shadow-lg)",transform:"translateY(-2px)"}},children:"login"===l?"Sign In":"Create Account"})]})]})},v="_authPage_1fizs_1",x="_error_1fizs_40",b="_formContainer_1fizs_53",C=()=>{const[e,o]=s.useState("login"),{login:t}=c(),u=l();g(!0);const[f,p]=s.useState(null);return r.jsxs(i,{className:v,children:[r.jsx(d,{}),r.jsxs(i,{className:b,children:[f&&r.jsx(a,{className:x,children:f}),r.jsx(h,{mode:e,onSubmit:async(r,o)=>{var a,n,i,s;if(!r||!o)return void p("Username and password are required");p(null);const l=`${m}/auth/${e}`;try{const e={username:r,password:o},c=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});let m;try{m=await c.json()}catch(d){throw console.error("[Client] Error parsing response:",d),new Error("Invalid response from server")}if(!c.ok)throw new Error(m.message||"Authentication failed");if(!(null==(a=m.user)?void 0:a.username)||!(null==(n=m.user)?void 0:n.id)||!m.token)throw console.error("[Client] Invalid response format:",{hasUser:!!m.user,hasUsername:!!(null==(i=m.user)?void 0:i.username),hasId:!!(null==(s=m.user)?void 0:s.id),hasToken:!!m.token}),new Error("Invalid server response format");try{t(m.user,m.token),u("/")}catch(d){throw console.error("[Client] Error in login callback:",d),new Error("Failed to initialize user session")}}catch(d){console.error("[Client] Auth error:",{message:d.message,endpoint:l,mode:e}),p(d.message||"Failed to connect to server")}}}),r.jsx(i,{textAlign:"center",mt:3,children:r.jsx(n,{color:"primary",onClick:()=>o("login"===e?"register":"login"),"data-gamepad-focusable":"true",sx:{color:"#ecf0f1",textTransform:"none",fontSize:"1rem","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:"login"===e?"Don't have an account? Register":"Already have an account? Login"})})]})]})};export{C as default};
//# sourceMappingURL=AuthPage-Ck9jB6ln.js.map
