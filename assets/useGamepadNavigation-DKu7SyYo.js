import{b as m}from"./vendor-CT7sGowS.js";const F=(h=!0)=>{const[E,y]=m.useState(null),[c,L]=m.useState([]),[B,N]=m.useState(!1),[k,x]=m.useState(!1),D=m.useRef(0),I=m.useRef({}),A=m.useCallback(()=>{if(!h)return;const f=Array.from(document.querySelectorAll('[data-gamepad-focusable="true"]:not([disabled]), [data-gamepad-scrollable="true"]')).filter(o=>{const b=o.getBoundingClientRect();if(b.width===0&&b.height===0){const t=o.closest("label")||o.closest('[class*="toggle"]')||o.parentElement;if(t){const l=t.getBoundingClientRect();if(l.width===0||l.height===0)return!1}else return!1}const d=document.querySelectorAll('[class*="modal"], [class*="Modal"], [role="dialog"], [class*="overlay"]');if(d.length>0){const t=Array.from(d).filter(l=>{const i=l.className;return i.includes("modal")||i.includes("Modal")||l.getAttribute("role")==="dialog"});if(t.length>0){const i=t.sort((s,v)=>{let p=parseInt(window.getComputedStyle(s).zIndex)||0,r=parseInt(window.getComputedStyle(v).zIndex)||0;if(p===0){const e=s.parentElement;e&&e.classList.toString().includes("overlay")&&(p=parseInt(window.getComputedStyle(e).zIndex)||0)}if(r===0){const e=v.parentElement;e&&e.classList.toString().includes("overlay")&&(r=parseInt(window.getComputedStyle(e).zIndex)||0)}return r-p})[0];return i&&i.contains(o)}}return!0});L(o=>o.length!==f.length||!o.every((b,d)=>b===f[d])?f:o)},[h]),g=m.useCallback(n=>{const f=Date.now();if(f-D.current<150||(D.current=f,!c.length))return;x(!0);const o=document.activeElement;let b=E;o&&o.getAttribute("data-gamepad-focusable")==="true"&&c.includes(o)&&(b=o,y(o));const d=c.findIndex(s=>s===b);if(d===-1||!b){const s=c[0];y(s),s.focus();return}const t=c[d];if(t?.getAttribute("data-gamepad-scrollable")==="true"&&(n==="up"||n==="down")){const v=t.scrollTop<=0,p=t.scrollTop>=t.scrollHeight-t.clientHeight;if(n==="up"&&!v){t.scrollTop=Math.max(0,t.scrollTop-50);return}if(n==="down"&&!p){t.scrollTop=Math.min(t.scrollHeight-t.clientHeight,t.scrollTop+50);return}}let i=null;if(n==="up"||n==="down"){let s=t?.getBoundingClientRect();if(!s)return;if(s.width===0&&s.height===0){const r=t.closest("label"),e=t.closest('[class*="toggle"]')||t.closest('[class*="Toggle"]'),a=r||e||t.parentElement;a&&(s=a.getBoundingClientRect())}const v=s.left+s.width/2,p=c.map((r,e)=>({el:r,index:e,rect:r.getBoundingClientRect()})).filter(({rect:r,index:e})=>e===d?!1:n==="up"?r.bottom<=s.top+20:r.top>=s.bottom-20);if(p.length>0)i=p.map(e=>({...e,horizontalDistance:Math.abs(e.rect.left+e.rect.width/2-v),verticalDistance:n==="up"?s.top-e.rect.bottom:e.rect.top-s.bottom})).sort((e,a)=>{const u=e.horizontalDistance-a.horizontalDistance;if(Math.abs(u)>100)return u;const w=e.verticalDistance-a.verticalDistance;return Math.abs(w)>10?w:u})[0].el;else{const r=c.filter((e,a)=>a!==d).map(e=>({el:e,rect:e.getBoundingClientRect()}));if(r.length>0){const e=n==="up"?0:window.innerHeight;i=r.reduce((u,w)=>{const C=Math.abs(w.rect.top-e),S=Math.abs(u.rect.top-e);return C<S?w:u}).el}else n==="up"?i=c[c.length-1]:i=c[0]}}else{const s=t?.getBoundingClientRect();if(!s)n==="left"?i=d>0?c[d-1]:c[c.length-1]:i=d<c.length-1?c[d+1]:c[0];else{const v=s.top+s.height/2,p=Math.max(s.height/2,20),r=c.map((a,u)=>({el:a,index:u,rect:a.getBoundingClientRect()})).filter(({rect:a})=>{const u=a.top+a.height/2;return Math.abs(u-v)<=p}).sort((a,u)=>a.rect.left-u.rect.left),e=r.findIndex(({el:a})=>a===t);e!==-1&&r.length>1?n==="left"?i=e>0?r[e-1].el:null:i=e<r.length-1?r[e+1].el:null:i=null}}i&&(y(i),i.focus())},[c,E]),M=m.useCallback(()=>{const n=document.activeElement?.getAttribute("data-gamepad-focusable")==="true"?document.activeElement:E;n&&(x(!0),n.click())},[E]);return m.useEffect(()=>{if(!h)return;const n=f=>{if(!(document.activeElement&&(document.activeElement.tagName==="INPUT"||document.activeElement.tagName==="TEXTAREA")&&f.key==="Enter"))switch(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(f.key)&&f.preventDefault(),f.key){case"ArrowUp":g("up");break;case"ArrowDown":g("down");break;case"ArrowLeft":g("left");break;case"ArrowRight":g("right");break;case"Enter":case" ":M();break}};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[g,M,h]),m.useEffect(()=>{if(!h)return;let n;const f=()=>{const o=navigator.getGamepads();let b=!1;for(let d=0;d<o.length;d++){const t=o[d];if(t&&t.connected){b=!0,I.current[d]||(I.current[d]={});const l=I.current[d],i=t.buttons[12]?.pressed,s=t.buttons[13]?.pressed,v=t.buttons[14]?.pressed,p=t.buttons[15]?.pressed,r=t.buttons[0]?.pressed;i&&!l.up&&g("up"),s&&!l.down&&g("down"),v&&!l.left&&g("left"),p&&!l.right&&g("right"),r&&!l.a&&M(),l.up=i,l.down=s,l.left=v,l.right=p,l.a=r;const e=t.axes[0]||0,a=t.axes[1]||0,u=.3;!l.stickMoved&&(Math.abs(e)>u||Math.abs(a)>u)?(Math.abs(e)>Math.abs(a)?e>u?g("right"):e<-u&&g("left"):a>u?g("down"):a<-u&&g("up"),l.stickMoved=!0):Math.abs(e)<=u&&Math.abs(a)<=u&&(l.stickMoved=!1);const w=t.axes[2]||0,C=t.axes[3]||0,S=.2,T=8;if(Math.abs(C)>S){const R=C*T;window.scrollBy(0,R)}if(Math.abs(w)>S){const R=w*T;window.scrollBy(R,0)}}}N(b),n=requestAnimationFrame(f)};return f(),()=>{n&&cancelAnimationFrame(n)}},[g,M,h]),m.useEffect(()=>{if(!h)return;const n=()=>{x(!1)};return document.addEventListener("mousemove",n),()=>document.removeEventListener("mousemove",n)},[h]),m.useEffect(()=>(k?document.body.classList.add("gamepad-navigation-active"):document.body.classList.remove("gamepad-navigation-active"),()=>{document.body.classList.remove("gamepad-navigation-active")}),[k]),m.useEffect(()=>{if(c.length>0&&!E){const n=c[0];y(n)}},[c,E]),m.useEffect(()=>{if(!h)return;const n=f=>{const o=f.target;o&&o.getAttribute("data-gamepad-focusable")==="true"&&(A(),setTimeout(()=>{Array.from(document.querySelectorAll('[data-gamepad-focusable="true"]:not([disabled]), [data-gamepad-scrollable="true"]')).includes(o)&&y(o)},0))};return document.addEventListener("focus",n,!0),()=>{document.removeEventListener("focus",n,!0)}},[h,A]),m.useEffect(()=>{if(!h)return;const n=new MutationObserver(A);return n.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-gamepad-focusable","disabled"]}),A(),()=>n.disconnect()},[A,h]),{focusedElement:E,isGamepadConnected:B,showFocusIndicator:k,registerNavigableElements:A}};export{F as u};
