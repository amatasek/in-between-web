const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AuthPage-DReMzcLq.js","assets/react-BvmXde1c.js","assets/vendor-Lk38keV2.js","assets/socket-DSjtHFVa.js","assets/AppHeader-HGUxaSQM.js","assets/mui-Dz5OUr-3.js","assets/AppHeader-BK9ybMct.css","assets/useGamepadNavigation-CyEH0bPn.js","assets/AuthPage-C81TTBkJ.css","assets/Lobby-Bud1xkub.js","assets/StoreModal-DV9AiUw8.js","assets/StoreModal-BAsCbv4F.css","assets/Lobby-D1K9TVYt.css","assets/GameRoom-ClmV3cvh.js","assets/GameRoom-vffvVCbz.css","assets/ProtectedRoute-Bn0H_fZ-.js"])))=>i.map(i=>d[i]);
import{j as e,r as t,g as n,N as r,d as o,h as s,i as a,l as i}from"./react-BvmXde1c.js";import{B as c}from"./vendor-Lk38keV2.js";import{l}from"./socket-DSjtHFVa.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const u=new class{constructor(){this.sounds={},this.muted=!1,this.initialized=!1,this.categories=["ui"],this.lastPlayedTime={},this.debounceTime=500,this.audioUnlocked=!1,this.API_URL="https://api.in-between.live","undefined"!=typeof window&&setTimeout((()=>{this.initialize(),this._setupMobileAudioUnlock()}),0)}initialize(){this.initialized||(this.loadCategory("ui"),this.initialized=!0)}loadCategory(e){if(this.sounds[e])return;const t={};"ui"===e&&(t.join=[0,500],t.leave=[500,1e3],t.alert=[1500,1500]),this.sounds[e]=new c.Howl({src:[`${this.API_URL}/assets/audio/${e}-sounds.mp3`,`${this.API_URL}/assets/audio/${e}-sounds.webm`],sprite:t,preload:!0,html5:this._isMobileDevice(),format:["mp3","webm"],pool:10})}play(e,t=1){if(this.muted)return;let n,r;if(this.initialized||this.initialize(),e.includes(".")?[n,r]=e.split("."):(n="ui",r=e),!this.sounds[n])return void this.loadCategory(n);const o=`${n}.${r}`,s=Date.now();return s-(this.lastPlayedTime[o]||0)<this.debounceTime?void 0:(this.lastPlayedTime[o]=s,this.sounds[n].volume(t),this.sounds[n].play(r))}setMuted(e){this.muted=e,Object.values(this.sounds).forEach((t=>{t&&t.mute&&t.mute(e)}))}syncWithPreferences(e){e&&void 0!==e.muted&&this.setMuted(e.muted)}_setupMobileAudioUnlock(){if("undefined"==typeof window||!this._isMobileDevice())return;const e=()=>{if(this.audioUnlocked)return;const t=new Audio;t.src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABIgD///////////////////////////////////////////8AAAA8TEFNRTMuMTAwAQAAAAAAAAAAABSAJAJAQgAAgAAAAiIkfC3/////////////////////",t.load(),t.play().then((()=>{this.audioUnlocked=!0,document.body.removeEventListener("touchstart",e),document.body.removeEventListener("touchend",e),document.body.removeEventListener("click",e)})).catch((e=>{}))};document.body.addEventListener("touchstart",e,!1),document.body.addEventListener("touchend",e,!1),document.body.addEventListener("click",e,!1)}_isMobileDevice(){return"undefined"!=typeof navigator&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)}},d={},m=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=e?.nonce||e?.getAttribute("nonce");r=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in d)return;d[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script"),o.crossOrigin="",o.href=e,n&&o.setAttribute("nonce",n),document.head.appendChild(o),t?new Promise(((t,n)=>{o.addEventListener("load",t),o.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)}))},p="_loadingScreen_16l5s_1",h="_loadingContainer_16l5s_10",f="_spinner_16l5s_21",_="_message_16l5s_31",w=({message:t="Loading..."})=>e.jsx("div",{className:p,children:e.jsxs("div",{className:h,children:[e.jsx("div",{className:f}),e.jsx("p",{className:_,children:t})]})}),y="https://api.in-between.live",b=t.createContext(null),A=({children:n})=>{const[r,o]=t.useState(null),[s,a]=t.useState(null),[i,c]=t.useState(!0),[l,u]=t.useState(!1),d=j(),m=d?.socket;t.useEffect((()=>{if(m&&r)return m.on("balanceUpdated",(e=>{if(e&&"number"==typeof e.balance){const t={...r,balance:e.balance};o(t)}})),()=>{m.off("balanceUpdated")}}),[m,r]);const p=async e=>{try{if(!e)return null;const t=await fetch(`${y}/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch user data");return(await t.json()).user}catch(t){return null}};t.useEffect((()=>{(async()=>{let e=null;try{e=localStorage.getItem("token"),e&&a(e)}catch(t){localStorage.removeItem("token")}if(e)try{const t=await p(e);t?o(t):(o(null),a(null),localStorage.removeItem("token"))}catch(t){o(null),a(null),localStorage.removeItem("token")}finally{c(!1)}else o(null),a(null),c(!1)})()}),[]);const h=t.useCallback((()=>{o(null),a(null),u(!1),localStorage.removeItem("token")}),[]),f=t.useCallback((async()=>{try{const e=await p(s);e?o(e):h()}catch(e){h()}}),[s,h]);return i?null:e.jsx(b.Provider,{value:{user:r,token:s,login:async(e,t)=>{if(!e||!e.username||!e.id||"number"!=typeof e.balance)throw new Error("Invalid user data provided");if(!t)throw new Error("No authentication token provided");try{const n={username:e.username,id:e.id,balance:e.balance};o(n),a(t),localStorage.setItem("token",t),u(!0);const r=await p(t);r&&o(r)}catch(n){throw n}},logout:h,refreshUserData:f,loading:i},children:n})},g=()=>{const e=t.useContext(b);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},v=t.createContext(),j=()=>t.useContext(v),x=({children:n})=>{const{token:r}=g(),[o,s]=t.useState(null),[a,i]=t.useState(!1),[c,u]=t.useState(null);t.useEffect((()=>{if("undefined"==typeof window)return;if(!r)return void(o&&(o.disconnect(),s(null),i(!1),u(null)));const e=l("https://api.in-between.live",{auth:{token:r},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,transports:["websocket","polling"],timeout:1e4});s(e),e.on("connect",(()=>{u(null)})),e.on("authenticated",(t=>{e.auth={userId:t.userId,username:t.username},i(!0),e.emit("getGameList")})),e.on("connect_error",(e=>{u("Failed to connect to game server: "+e.message),i(!1)})),e.on("disconnect",(()=>{i(!1)})),e.on("error",(e=>{u(e.message||"Unknown socket error")}));const t=["connect","authenticated","disconnect","connect_error","error","transport"];return()=>{e&&(t.forEach((t=>e.off(t))),e.disconnect(),s(null),i(!1),u(null))}}),[r]);const d={socket:o,isConnected:a,error:c,setError:u};return e.jsx(v.Provider,{value:d,children:n})},k=t.createContext(),S=()=>t.useContext(k),E=({children:n})=>{const{socket:r,isConnected:o}=j(),[s,a]=t.useState([]),[i,c]=t.useState(!0),[l,u]=t.useState(null);t.useEffect((()=>{if(!r||!o)return;const e=e=>{a(e),c(!1)},t=e=>{u(e.message||"An error occurred"),c(!1)};return r.on("gameList",e),r.on("error",t),r.emit("getGameList"),()=>{r.off("gameList",e),r.off("error",t)}}),[r,o]);const d={gameList:s,loading:i,error:l};return e.jsx(k.Provider,{value:d,children:n})},C=t.lazy((()=>m((()=>import("./AuthPage-DReMzcLq.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8])))),P=t.lazy((()=>m((()=>import("./Lobby-Bud1xkub.js")),__vite__mapDeps([9,1,2,3,7,4,5,6,10,11,12])))),I=t.lazy((()=>m((()=>import("./GameRoom-ClmV3cvh.js")),__vite__mapDeps([13,1,2,3,10,11,7,14])))),T=t.lazy((()=>m((()=>import("./ProtectedRoute-Bn0H_fZ-.js")),__vite__mapDeps([15,1,2,3])))),$=n([{path:"/",element:e.jsx(t.Suspense,{fallback:e.jsx(w,{message:"Loading..."}),children:e.jsx(T,{children:e.jsx(E,{children:e.jsx(t.Suspense,{fallback:e.jsx(w,{message:"Loading..."}),children:e.jsx(P,{})})})})})},{path:"/auth",element:e.jsx(t.Suspense,{fallback:e.jsx(w,{message:"Loading..."}),children:e.jsx(C,{})})},{path:"/:gameId",element:e.jsx(t.Suspense,{fallback:e.jsx(w,{message:"Loading..."}),children:e.jsx(T,{children:e.jsx(t.Suspense,{fallback:e.jsx(w,{message:"Loading..."}),children:e.jsx(I,{})})})})},{path:"*",element:e.jsx(r,{to:"/",replace:!0})}]),L={overlay:"_overlay_j8a1u_1",modal:"_modal_j8a1u_17",header:"_header_j8a1u_38",closeButton:"_closeButton_j8a1u_55",sectionHeader:"_sectionHeader_j8a1u_74",settingItem:"_settingItem_j8a1u_90",settingControls:"_settingControls_j8a1u_106",primaryButton:"_primaryButton_j8a1u_113",settingDescription:"_settingDescription_j8a1u_135",textInput:"_textInput_j8a1u_157",inputError:"_inputError_j8a1u_175",errorMessage:"_errorMessage_j8a1u_180",content:"_content_j8a1u_190",footer:"_footer_j8a1u_233"};function N({title:n,onClose:r,children:s,footer:a,headerButtons:i,className:c="",overlayStyle:l,...u}){t.useEffect((()=>{if("undefined"!=typeof window)return window.__modalCount=(window.__modalCount||0)+1,1===window.__modalCount&&document.body.classList.add("modal-open"),()=>{window.__modalCount=Math.max(0,(window.__modalCount||0)-1),0===window.__modalCount&&document.body.classList.remove("modal-open")}}),[]);const d=e.jsx("div",{className:L.overlay,style:l,onClick:r,children:e.jsxs("div",{className:`${L.modal} ${c}`,onClick:e=>e.stopPropagation(),...u,children:[n&&e.jsxs("div",{className:L.header,children:[e.jsx("h2",{children:n}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[i,e.jsx("button",{className:L.closeButton,onClick:r,"aria-label":"Close",type:"button","data-gamepad-focusable":"true",children:"Ã—"})]})]}),e.jsx("div",{className:L.content,children:s}),a&&e.jsx("div",{className:L.footer,children:a})]})});return o.createPortal(d,document.body)}"undefined"==typeof window||window.__modalCount||(window.__modalCount=0);const M="_keyboardModal_7mp5j_2",D="_inputDisplay_7mp5j_7",U="_tempInput_7mp5j_13",O="_keyboardGrid_7mp5j_31",z="_keyRow_7mp5j_35",B="_key_7mp5j_2",q="_specialKey_7mp5j_77",G="_spaceKey_7mp5j_86",F="_activeShift_7mp5j_91",R=({isVisible:n,onClose:r,onEnter:o,inputType:s="text",initialValue:a=""})=>{const{keyboardTitle:i}=K(),[c,l]=t.useState("lowercase"),[u,d]=t.useState("");t.useEffect((()=>{d(n?"number"===s?a&&"0"!==a?a:"":a||"":"")}),[n,a,s]);const m={lowercase:[["1","2","3","4","5","6","7","8","9","0"],["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["shift","z","x","c","v","b","n","m","backspace"],["space","enter"]],uppercase:[["1","2","3","4","5","6","7","8","9","0"],["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["shift","Z","X","C","V","B","N","M","backspace"],["space","enter"]],numbers:[["1","2","3"],["4","5","6"],["7","8","9"],["0","backspace"],["enter"]]}["number"===s?"numbers":c],p=t.useCallback((e=>{switch(e){case"shift":l((e=>"lowercase"===e?"uppercase":"lowercase"));break;case"backspace":d((e=>e.slice(0,-1)));break;case"enter":o?.(u);break;case"space":d((e=>e+" "));break;default:d((t=>t+e))}}),[o,u]),h=e=>{switch(e){case"shift":return"â‡§";case"backspace":return"âŒ«";case"space":return"Space";case"enter":return"â†µ";default:return e}},f=e=>{let t=B;return["shift","backspace","space","enter"].includes(e)&&(t+=` ${q}`),"space"===e&&(t+=` ${G}`),"shift"===e&&"uppercase"===c&&(t+=` ${F}`),t};return t.useEffect((()=>{if(n){const e=e=>{"Escape"===e.key&&(e.preventDefault(),r?.())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}}),[n,r]),n?e.jsxs(N,{title:i||("number"===s?"Number Pad":"Virtual Keyboard"),onClose:r,className:M,overlayStyle:{zIndex:1300},children:[e.jsx("div",{className:D,children:e.jsx("input",{type:"password"===s?"password":"text",value:u,className:U,readOnly:!0,placeholder:"Type below..."})}),e.jsx("div",{className:O,children:m.map(((t,n)=>e.jsx("div",{className:z,children:t.map(((t,r)=>e.jsx("button",{className:f(t),onClick:()=>p(t),"data-gamepad-focusable":"true","aria-label":"backspace"===t?"Backspace":"enter"===t?"Enter":"space"===t?"Space":"shift"===t?"Shift":t,children:h(t)},`${n}-${r}`)))},n)))})]}):null},V=t.createContext(),K=()=>{const e=t.useContext(V);if(!e)throw new Error("useVirtualKeyboardContext must be used within a VirtualKeyboardProvider");return e},J=({children:n})=>{const r=(()=>{const[e,n]=t.useState(!1),[r,o]=t.useState(null),[s,a]=t.useState("text"),[i,c]=t.useState(""),[l,u]=t.useState(!1);t.useEffect((()=>{const e=()=>{const e=document.body.classList.contains("gamepad-navigation-active");u(e)};e();const t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>t.disconnect()}),[]);const d=t.useCallback(((e,t="text",r="")=>{e&&(o(e),a(t),c(r),n(!0),e.blur())}),[]),m=t.useCallback((()=>{n(!1),o(null),a("text"),c("")}),[]),p=t.useCallback((e=>{if(!r)return;Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(r,e||"");const t=new Event("input",{bubbles:!0});r.dispatchEvent(t);const n=new Event("change",{bubbles:!0});r.dispatchEvent(n),m()}),[r,m]),h=t.useCallback(((e,t="text",n="")=>{if(!e)return;let r=e;e.querySelector&&e.querySelector("input")&&(r=e.querySelector("input"));const o=e=>{l&&document.body.classList.contains("gamepad-navigation-active")&&(e.preventDefault(),d(r,t,n))};return r.addEventListener("click",o),()=>{r.removeEventListener("click",o)}}),[l,d]),f=t.useCallback((()=>r?.value||""),[r]);return{isVisible:e,inputType:s,keyboardTitle:i,currentInput:r,isGamepadActive:l,showKeyboard:d,hideKeyboard:m,handleEnter:p,enhanceInput:h,getCurrentInputValue:f}})(),{isVisible:o,inputType:s,hideKeyboard:a,handleEnter:i,getCurrentInputValue:c}=r;return e.jsxs(V.Provider,{value:r,children:[n,o&&e.jsx(R,{isVisible:o,inputType:s,initialValue:c(),onClose:a,onEnter:i})]})},W="_toast_1yqi6_1",H="_slideOut_1yqi6_31",Q="_iconWrapper_1yqi6_46",Z="_icon_1yqi6_46",X="_emojiIcon_1yqi6_61",Y="_content_1yqi6_75",ee="_title_1yqi6_82",te="_message_1yqi6_89",ne="_emojiMessage_1yqi6_97",re="_playerName_1yqi6_104",oe="_reactionText_1yqi6_110",se="_emojiReaction_1yqi6_116",ae="_closeButton_1yqi6_134",ie=({title:n,message:r,emoji:o="â„¹",color:s="#3498db",duration:a=4e3,onClose:i,position:c})=>{const[l,u]=t.useState(!0);t.useEffect((()=>{if(a>0){const e=setTimeout((()=>{u(!1),setTimeout(i,300)}),a);return()=>clearTimeout(e)}}),[a,i]);const d=!n&&"â„¹"!==o;return e.jsxs("div",{className:`${W} ${d&&l?se:""} ${l?"":H}`,style:{top:"20px",zIndex:1e4+c,borderColor:s,background:"linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)"},children:[e.jsx("div",{className:Q,children:e.jsx("span",{className:`${Z} ${d?X:""}`,style:{color:s,textShadow:d?`0 0 20px ${s}, 0 0 40px ${s}60`:`0 0 8px ${s}80`},children:o})}),e.jsxs("div",{className:Y,children:[n&&e.jsx("div",{className:ee,children:n}),e.jsx("div",{className:`${te} ${d?ne:""}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:re,children:r}),e.jsx("span",{className:oe,children:"reacted!"})]}):r})]}),e.jsx("button",{className:ae,onClick:i,"aria-label":"Close notification",children:"Ã—"})]})},ce=t.createContext(),le=({children:n})=>{const[r,o]=t.useState([]),[s,a]=t.useState([]),[i,c]=t.useState(0),{socket:l}=j(),u=t.useCallback(((e,t,n="â„¹",r="#3498db",s=4e3)=>{const l=Date.now()+Math.random(),u={id:l,title:e,message:t,emoji:n,color:r,duration:s},d=Date.now();return d-i>=600?(o((e=>[...e,u])),c(d)):a((e=>[...e,u])),l}),[i]),d=t.useCallback((e=>{o((t=>t.filter((t=>t.id!==e))))}),[]),m=t.useCallback(((e,t,n)=>u(e,t,"âœ“","#27ae60",n)),[u]),p=t.useCallback(((e,t,n)=>u(e,t,"âœ•","#e74c3c",n)),[u]),h=t.useCallback(((e,t,n)=>u(e,t,"âš ","#f39c12",n)),[u]),f=t.useCallback(((e,t,n)=>u(e,t,"â„¹","#3498db",n)),[u]),_=t.useCallback(((e,t,n)=>u(e,t,"ðŸŽ®","#9b59b6",n)),[u]),w=t.useCallback(((e,t,n)=>u(e,t,"ðŸ’°","#16a085",n)),[u]);t.useEffect((()=>{if(0===s.length)return;const e=setTimeout((()=>{const e=s[0];a((e=>e.slice(1))),o((t=>[...t,e])),c(Date.now())}),600);return()=>clearTimeout(e)}),[s,r]),t.useEffect((()=>{if(!l)return;const e=e=>{u(e.title||"",e.message,e.emoji||"â„¹",e.color||"#3498db",e.duration)};return l.on("toast",e),()=>{l.off("toast",e)}}),[l,u]);const y={addToast:u,removeToast:d,showSuccess:m,showError:p,showWarning:h,showInfo:f,showGameEvent:_,showMoneyEvent:w,toasts:r};return e.jsxs(ce.Provider,{value:y,children:[n,e.jsx("div",{className:"toast-container",style:{position:"fixed",top:0,right:0,zIndex:1e4},children:r.map(((t,n)=>e.jsx(ie,{title:t.title,message:t.message,emoji:t.emoji,color:t.color,duration:t.duration,position:n,onClose:()=>d(t.id)},t.id)))})]})};function ue(){return t.useEffect((()=>{u.initialize()}),[]),e.jsx(le,{children:e.jsx(J,{children:e.jsx(s,{router:$})})})}const de=t.createContext(null),me=e=>{if(!e)return null;const t="https://api.in-between.live";if(e.startsWith("http"))return e;if(e.startsWith("/files/"))return`${t}${e}`;if(e.includes("/uploads/")){const n=e.split("/"),r=n.pop();return`${t}/files/${n[n.length-1]}/${r}`}return`${t}${e}`},pe=e=>e?{...e,profileImg:me(e.profileImg),twoSecondPotGif:me(e.twoSecondPotGif),twoSecondPotMp3:e.twoSecondPotMp3}:{},he=({children:n})=>{const[r,o]=t.useState({profileImg:null,autoAnte:!1,muted:!1,twoSecondPotGif:null,twoSecondPotMp3:null,selectedTitle:null}),[s,i]=t.useState(!0),{user:c}=g(),l=a.useCallback((async()=>{if(!c)return o({autoAnte:!1}),void i(!1);try{i(!0);const e="https://api.in-between.live",t=localStorage.getItem("token");if(!t)return void i(!1);const n=await fetch(`${e}/preferences`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("Failed to load preferences");const r=await n.json(),s=pe(r)||{autoAnte:!1,muted:!1};o(s),void 0!==s.muted&&u.setMuted(s.muted)}catch(e){o({autoAnte:!1})}finally{i(!1)}}),[c]);t.useEffect((()=>{c&&l()}),[c,l]);const d=async(e,t)=>{if(!c)return!1;try{const n="https://api.in-between.live",r=localStorage.getItem("token");if(!r)return!1;o((n=>({...n,[e]:t}))),"muted"===e&&u.setMuted(t);const s=await fetch(`${n}/preferences/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({value:t})});if(!s.ok)throw new Error(`Failed to update ${e} preference`);const a=await s.json(),i=pe(a);return o(i),!0}catch(n){return await l(),!1}};return e.jsx(de.Provider,{value:{preferences:r,updatePreference:d,toggleAutoAnte:async()=>{const e=!r.autoAnte;return await d("autoAnte",e)},toggleMute:async()=>{const e=!r.muted;return await d("muted",e)},updateSelectedTitle:async e=>await d("selectedTitle",e),uploadTwoSecondPotGif:async e=>{if(!e)return!1;try{const t=new FormData;t.append("file",e);const n="https://api.in-between.live",r=localStorage.getItem("token");if(!r)return!1;const s=await fetch(`${n}/preferences/twoSecondPotGif`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t}),a=await s.text();if(!s.ok)throw new Error(`Failed to upload GIF file: ${a}`);const i=a?JSON.parse(a):{},c=me(i.fileUrl);return o((e=>({...e,twoSecondPotGif:c}))),!0}catch(t){return!1}},uploadTwoSecondPotMp3:async e=>{if(!e)return!1;try{const t=new FormData;t.append("file",e);const n="https://api.in-between.live",r=localStorage.getItem("token");if(!r)return!1;const s=await fetch(`${n}/preferences/twoSecondPotMp3`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t}),a=await s.text();if(!s.ok)throw new Error(`Failed to upload MP3 file: ${a}`);const i=a?JSON.parse(a):{};return o((e=>({...e,twoSecondPotMp3:i.fileUrl}))),!0}catch(t){return!1}},uploadProfileImg:async e=>{if(!e)return!1;try{const t=new FormData;t.append("file",e);const n="https://api.in-between.live",r=localStorage.getItem("token");if(!r)return!1;const s=await fetch(`${n}/preferences/profileImg`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t}),a=await s.text();if(!s.ok)throw new Error(`Failed to upload profile image: ${a}`);const i=a?JSON.parse(a):{},c=me(i.fileUrl);return o((e=>({...e,profileImg:c}))),!0}catch(t){return!1}},loading:s},children:n})},fe=()=>{const e=t.useContext(de);if(!e)throw new Error("usePreferences must be used within a PreferencesProvider");return e},_e=t.createContext(null),we=({children:n})=>{const{socket:r}=j(),{token:o}=g(),[s,a]=t.useState(new Map),i=t.useRef(new Set),c=t.useRef(null);t.useEffect((()=>{if(!r)return;const e=({userId:e,data:t})=>{a((n=>{const r=new Map(n);return r.set(e,t),r}))};return r.on("userDataUpdated",e),()=>{r.off("userDataUpdated",e)}}),[r]),t.useEffect((()=>()=>{c.current&&clearTimeout(c.current)}),[]);const l=t.useCallback((async e=>{if(!e||0===e.length||!o)return{};try{const t=await fetch(`${y}/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({userIds:e})});if(!t.ok)throw new Error("Failed to fetch users data");const n=await t.json();return a((e=>{const t=new Map(e);return Object.entries(n).forEach((([e,n])=>{t.set(e,n)})),t})),n}catch(t){return{}}}),[o]),u=t.useCallback((()=>{if(0===i.current.size)return;const e=Array.from(i.current);i.current.clear(),l(e)}),[l]),d={getUserData:t.useCallback((e=>{if(!e)return null;const t=s.get(e);return t||(i.current.add(e),c.current&&clearTimeout(c.current),c.current=setTimeout((()=>{u()}),10),null)}),[s,u]),prefetchUsers:t.useCallback((e=>{const t=e.filter((e=>!s.has(e)));t.length>0&&l(t)}),[s,l])};return e.jsx(_e.Provider,{value:d,children:n})},ye=e=>{const n=t.useContext(_e);if(!n)throw new Error("useUserData must be used within UserDataProvider");return n.getUserData(e)};i.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(A,{children:e.jsx(x,{children:e.jsx(we,{children:e.jsx(he,{children:e.jsx(ue,{})})})})})}));export{y as A,N as B,w as L,_e as U,j as a,ye as b,L as c,S as d,K as e,fe as f,u as s,g as u};
