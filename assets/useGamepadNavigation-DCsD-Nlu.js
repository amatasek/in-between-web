import{b as m}from"./vendor-ByZL_ylL.js";const F=(h=!0)=>{const[E,y]=m.useState(null),[l,L]=m.useState([]),[B,N]=m.useState(!1),[S,k]=m.useState(!1),D=m.useRef(0),I=m.useRef({}),A=m.useCallback(()=>{if(!h)return;const f=Array.from(document.querySelectorAll('[data-gamepad-focusable="true"]:not([disabled]), [data-gamepad-scrollable="true"]')).filter(r=>{const b=r.getBoundingClientRect();if(b.width===0&&b.height===0){const t=r.closest("label")||r.closest('[class*="toggle"]')||r.parentElement;if(t){const c=t.getBoundingClientRect();if(c.width===0||c.height===0)return!1}else return!1}const u=document.querySelectorAll('[class*="modal"], [class*="Modal"], [role="dialog"], [class*="overlay"]');if(u.length>0){const t=Array.from(u).filter(c=>{const i=c.className;return i.includes("modal")||i.includes("Modal")||c.getAttribute("role")==="dialog"});if(t.length>0){const i=t.sort((s,v)=>{let p=parseInt(window.getComputedStyle(s).zIndex)||0,a=parseInt(window.getComputedStyle(v).zIndex)||0;if(p===0){const e=s.parentElement;e&&e.classList.toString().includes("overlay")&&(p=parseInt(window.getComputedStyle(e).zIndex)||0)}if(a===0){const e=v.parentElement;e&&e.classList.toString().includes("overlay")&&(a=parseInt(window.getComputedStyle(e).zIndex)||0)}return a-p})[0];return i&&i.contains(r)}}return!0});L(r=>r.length!==f.length||!r.every((b,u)=>b===f[u])?f:r)},[h]),g=m.useCallback(n=>{const f=Date.now();if(f-D.current<150||(D.current=f,!l.length))return;k(!0);const r=document.activeElement;let b=E;r&&r.getAttribute("data-gamepad-focusable")==="true"&&l.includes(r)&&(b=r,y(r));const u=l.findIndex(s=>s===b);if(u===-1||!b){const s=l[0];y(s),s.focus();return}const t=l[u];if(t?.getAttribute("data-gamepad-scrollable")==="true"&&(n==="up"||n==="down")){const v=t.scrollTop<=0,p=t.scrollTop>=t.scrollHeight-t.clientHeight;if(n==="up"&&!v){t.scrollTop=Math.max(0,t.scrollTop-50);return}if(n==="down"&&!p){t.scrollTop=Math.min(t.scrollHeight-t.clientHeight,t.scrollTop+50);return}}let i=null;if(n==="up"||n==="down"){let s=t?.getBoundingClientRect();if(!s)return;if(s.width===0&&s.height===0){const a=t.closest("label"),e=t.closest('[class*="toggle"]')||t.closest('[class*="Toggle"]'),o=a||e||t.parentElement;o&&(s=o.getBoundingClientRect())}const v=s.left+s.width/2,p=l.map((a,e)=>({el:a,index:e,rect:a.getBoundingClientRect()})).filter(({el:a,rect:e,index:o})=>o===u?!1:n==="up"?e.bottom<=s.top+20:e.top>=s.bottom-20);if(p.length>0)i=p.map(e=>({...e,horizontalDistance:Math.abs(e.rect.left+e.rect.width/2-v),verticalDistance:n==="up"?s.top-e.rect.bottom:e.rect.top-s.bottom})).sort((e,o)=>{const d=e.horizontalDistance-o.horizontalDistance;if(Math.abs(d)>100)return d;const w=e.verticalDistance-o.verticalDistance;return Math.abs(w)>10?w:d})[0].el;else{const a=l.filter((e,o)=>o!==u).map((e,o)=>({el:e,rect:e.getBoundingClientRect()}));if(a.length>0){const e=n==="up"?0:window.innerHeight;i=a.reduce((d,w)=>{const C=Math.abs(w.rect.top-e),x=Math.abs(d.rect.top-e);return C<x?w:d}).el}else n==="up"?i=l[l.length-1]:i=l[0]}}else{const s=t?.getBoundingClientRect();if(!s)n==="left"?i=u>0?l[u-1]:l[l.length-1]:i=u<l.length-1?l[u+1]:l[0];else{const v=s.top+s.height/2,p=Math.max(s.height/2,20),a=l.map((o,d)=>({el:o,index:d,rect:o.getBoundingClientRect()})).filter(({rect:o,index:d})=>{const w=o.top+o.height/2;return Math.abs(w-v)<=p}).sort((o,d)=>o.rect.left-d.rect.left),e=a.findIndex(({el:o})=>o===t);e!==-1&&a.length>1?n==="left"?i=e>0?a[e-1].el:null:i=e<a.length-1?a[e+1].el:null:i=null}}i&&(y(i),i.focus())},[l,E]),M=m.useCallback(()=>{const n=document.activeElement?.getAttribute("data-gamepad-focusable")==="true"?document.activeElement:E;n&&(k(!0),n.click())},[E]);return m.useEffect(()=>{if(!h)return;const n=f=>{if(!(document.activeElement&&(document.activeElement.tagName==="INPUT"||document.activeElement.tagName==="TEXTAREA")&&f.key==="Enter"))switch(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(f.key)&&f.preventDefault(),f.key){case"ArrowUp":g("up");break;case"ArrowDown":g("down");break;case"ArrowLeft":g("left");break;case"ArrowRight":g("right");break;case"Enter":case" ":M();break}};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[g,M,h]),m.useEffect(()=>{if(!h)return;let n;const f=()=>{const r=navigator.getGamepads();let b=!1;for(let u=0;u<r.length;u++){const t=r[u];if(t&&t.connected){b=!0,I.current[u]||(I.current[u]={});const c=I.current[u],i=t.buttons[12]?.pressed,s=t.buttons[13]?.pressed,v=t.buttons[14]?.pressed,p=t.buttons[15]?.pressed,a=t.buttons[0]?.pressed;i&&!c.up&&g("up"),s&&!c.down&&g("down"),v&&!c.left&&g("left"),p&&!c.right&&g("right"),a&&!c.a&&M(),c.up=i,c.down=s,c.left=v,c.right=p,c.a=a;const e=t.axes[0]||0,o=t.axes[1]||0,d=.3;!c.stickMoved&&(Math.abs(e)>d||Math.abs(o)>d)?(Math.abs(e)>Math.abs(o)?e>d?g("right"):e<-d&&g("left"):o>d?g("down"):o<-d&&g("up"),c.stickMoved=!0):Math.abs(e)<=d&&Math.abs(o)<=d&&(c.stickMoved=!1);const w=t.axes[2]||0,C=t.axes[3]||0,x=.2,T=8;if(Math.abs(C)>x){const R=C*T;window.scrollBy(0,R)}if(Math.abs(w)>x){const R=w*T;window.scrollBy(R,0)}}}N(b),n=requestAnimationFrame(f)};return f(),()=>{n&&cancelAnimationFrame(n)}},[g,M,h]),m.useEffect(()=>{if(!h)return;const n=()=>{k(!1)};return document.addEventListener("mousemove",n),()=>document.removeEventListener("mousemove",n)},[h]),m.useEffect(()=>(S?document.body.classList.add("gamepad-navigation-active"):document.body.classList.remove("gamepad-navigation-active"),()=>{document.body.classList.remove("gamepad-navigation-active")}),[S]),m.useEffect(()=>{if(l.length>0&&!E){const n=l[0];y(n)}},[l.length]),m.useEffect(()=>{if(!h)return;const n=f=>{const r=f.target;r&&r.getAttribute("data-gamepad-focusable")==="true"&&(A(),setTimeout(()=>{Array.from(document.querySelectorAll('[data-gamepad-focusable="true"]:not([disabled]), [data-gamepad-scrollable="true"]')).includes(r)&&y(r)},0))};return document.addEventListener("focus",n,!0),()=>{document.removeEventListener("focus",n,!0)}},[h,A]),m.useEffect(()=>{if(!h)return;const n=new MutationObserver(A);return n.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-gamepad-focusable","disabled"]}),A(),()=>n.disconnect()},[A,h]),{focusedElement:E,isGamepadConnected:B,showFocusIndicator:S,registerNavigableElements:A}};export{F as u};
