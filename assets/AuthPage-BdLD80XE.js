import{V as E,U as e,X as A,q as _,Y as P}from"./index-cIpQxAdt.js";import{r as t,u as S}from"./vendor-x77BqUlH.js";import{u as R}from"./useGamepadNavigation-Cg7hbHyW.js";import{A as k}from"./AppHeader-DbeiyUzT.js";import"./audio-DijUiIHu.js";import"./socket-CA1CrNgP.js";const q="_authForm_1lg5o_1",F="_errorAlert_1lg5o_95",C={authForm:q,errorAlert:F},T=({onSubmit:l,mode:s,requireEmail:n=!1,title:h=null,description:u=null})=>{const[o,d]=t.useState(""),[a,i]=t.useState(""),[p,N]=t.useState(""),[w,j]=t.useState(""),f=t.useRef(null),x=t.useRef(null),v=t.useRef(null),{enhanceInput:g}=E();t.useEffect(()=>{let r,c,y;return f.current&&(r=g(f.current,"text","Enter Username")),x.current&&(c=g(x.current,"password","Enter Password")),v.current&&n&&(y=g(v.current,"email","Enter Email")),()=>{r&&r(),c&&c(),y&&y()}},[g,n]);const b=async r=>{r.preventDefault(),j("");try{n?await l(o,a,p):await l(o,a)}catch(c){j(c.message)}};return e.jsxs("div",{className:`card ${C.authForm}`,children:[e.jsx("h2",{style:{color:"var(--text-primary)",fontWeight:600,textAlign:"center",marginTop:0},children:h||(s==="login"?"Welcome Back":s==="migrate"?"Migrate Your Account":"Create Account")}),u&&e.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",marginBottom:"1rem"},children:u}),e.jsx("div",{className:"divider",style:{marginBottom:"1.5rem"}}),w&&e.jsx("div",{className:C.errorAlert,children:w}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"username",className:"input-label required",children:"Username"}),e.jsx("input",{ref:f,id:"username",type:"text",className:"no-validation",placeholder:"Enter your username",value:o,onChange:r=>d(r.target.value),required:!0,minLength:3,"data-gamepad-focusable":"true",autoCapitalize:"none",autoCorrect:"off",autoComplete:"username"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"password",className:"input-label required",children:"Password"}),e.jsx("input",{ref:x,id:"password",type:"password",className:"no-validation",placeholder:"Enter your password",value:a,onChange:r=>i(r.target.value),required:!0,minLength:6,"data-gamepad-focusable":"true",autoComplete:s==="login"?"current-password":"new-password"})]}),n&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"email",className:"input-label required",children:"Email"}),e.jsx("input",{ref:v,id:"email",type:"email",className:"no-validation",placeholder:"Enter your email address",value:p,onChange:r=>N(r.target.value),required:!0,"data-gamepad-focusable":"true",autoCapitalize:"none",autoCorrect:"off",autoComplete:"email"})]}),e.jsx("button",{type:"submit",className:"btn btn-primary","data-gamepad-focusable":"true",children:s==="login"?"Sign In":s==="migrate"?"Migrate Account":"Create Account"})]})]})},I="_authPage_11yqn_1",U="_formContainer_11yqn_21",m={authPage:I,formContainer:U},O=()=>{const l=S();R(!1);const[s,n]=t.useState(null),h=async(u,o,d)=>{if(!u||!o||!d)throw new Error("Username, password, and email are required");n(null);try{const a=await fetch(`${A}/auth/migrate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:u,password:o,email:d})});let i;try{i=await a.json()}catch(p){throw console.error("[Client] Error parsing response:",p),new Error("Invalid response from server")}if(!a.ok)throw new Error(i.message||"Migration failed");if(!i.customToken)throw console.error("[Client] Invalid response format: missing customToken"),new Error("Invalid server response format");await _(P,i.customToken),n("Account migrated successfully! Redirecting..."),setTimeout(()=>{l("/")},1500)}catch(a){throw console.error("[Client] Migration error:",{message:a.message}),a}};return e.jsxs("div",{className:`screen ${m.authPage}`,children:[e.jsx(k,{}),e.jsxs("div",{className:m.formContainer,children:[s&&e.jsx("div",{className:m.successAlert,children:s}),e.jsx(T,{mode:"migrate",requireEmail:!0,onSubmit:h,description:"Enter your existing username and password, plus an email address to migrate your legacy account."}),e.jsx("div",{className:m.toggleContainer,children:e.jsx("button",{className:m.toggleButton,onClick:()=>l("/auth"),"data-gamepad-focusable":"true",children:"Back to Login"})})]})]})};export{O as default};
